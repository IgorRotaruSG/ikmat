function GameObject(){this.zOrder=0,this.x=0,this.y=0,this.startupGameObject=function(a,b,c){return this.zOrder=c,this.x=a,this.y=b,g_GameObjectManager.addGameObject(this),this},this.shutdownGameObject=function(){g_GameObjectManager.removeGameObject(this)}}function VisualGameObject(){this.image=null,this.draw=function(a,b,c,d){b.drawImage(this.image,this.x-c,this.y-d)},this.startupVisualGameObject=function(a,b,c,d){return this.startupGameObject(b,c,d),this.image=a,this},this.shutdownVisualGameObject=function(){this.shutdownGameObject()}}function RepeatingGameObject(){this.width=0,this.height=0,this.scrollFactor=1,this.startupRepeatingGameObject=function(a,b,c,d,e,f,g){return this.startupVisualGameObject(a,b,c,d),this.width=e,this.height=f,this.scrollFactor=g,this},this.shutdownstartupRepeatingGameObject=function(){this.shutdownVisualGameObject()},this.draw=function(a,b,c,d){for(var e=[0,0],f=0;f<this.height;f+=e[1])for(var g=0;g<this.width;g+=e[0]){var h=[this.x+g,this.y+f],i=[this.width-g,this.height-f],j=[0,0];0==g&&(j[0]=c*this.scrollFactor),0==f&&(j[1]=d*this.scrollFactor),e=this.drawRepeat(b,h,i,j)}},this.drawRepeat=function(a,b,c,d){var e=Math.abs(d[0])%this.image.width,f=Math.abs(d[1])%this.image.height,g=d[0]<0?this.image.width-e:e,h=d[1]<0?this.image.height-f:f,i=c[0]<this.image.width-g?c[0]:this.image.width-g,j=c[1]<this.image.height-h?c[1]:this.image.height-h;return a.drawImage(this.image,g,h,i,j,b[0],b[1],i,j),[i,j]}}function AnimatedGameObject(){this.currentFrame=0,this.timeBetweenFrames=0,this.timeSinceLastFrame=0,this.frameWidth=0,this.startupAnimatedGameObject=function(a,b,c,d,e,f){if(0>=e)throw"framecount can not be <= 0";if(0>=f)throw"fps can not be <= 0";this.startupVisualGameObject(a,b,c,d),this.currentFrame=0,this.frameCount=e,this.timeBetweenFrames=1/f,this.timeSinceLastFrame=this.timeBetweenFrames,this.frameWidth=this.image.width/this.frameCount},this.draw=function(a,b,c,d){var e=this.frameWidth*this.currentFrame;b.drawImage(this.image,e,0,this.frameWidth,this.image.height,this.x-c,this.y-d,this.frameWidth,this.image.height),this.timeSinceLastFrame-=a,this.timeSinceLastFrame<=0&&(this.timeSinceLastFrame=this.timeBetweenFrames,++this.currentFrame,this.currentFrame%=this.frameCount)}}function ApplicationManager(){this.startupApplicationManager=function(){return this.runner=(new AnimatedGameObject).startupAnimatedGameObject(g_run,0,0,1,cTotalFrames,FPS),this}}function GameObjectManager(){this.gameObjects=new Array,this.lastFrame=(new Date).getTime(),this.xScroll=0,this.yScroll=0,this.applicationManager=null,this.canvas=null,this.context2D=null,this.backBuffer=null,this.backBufferContext2D=null,this.startupGameObjectManager=function(){return g_GameObjectManager=this,this.canvas=document.getElementById("canvas"),this.context2D=this.canvas.getContext("2d"),this.backBuffer=document.createElement("canvas"),this.backBuffer.width=this.canvas.width,this.backBuffer.height=this.canvas.height,this.backBufferContext2D=this.backBuffer.getContext("2d"),this.applicationManager=(new ApplicationManager).startupApplicationManager(),setInterval(function(){g_GameObjectManager.draw()},SECONDS_BETWEEN_FRAMES),this},this.draw=function(){var a=(new Date).getTime(),b=(a-this.lastFrame)/1e3;this.lastFrame=a,this.backBufferContext2D.clearRect(0,0,this.backBuffer.width,this.backBuffer.height),this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height);for(x in this.gameObjects)this.gameObjects[x].update&&this.gameObjects[x].update(b,this.backBufferContext2D,this.xScroll,this.yScroll);for(x in this.gameObjects)this.gameObjects[x].draw&&this.gameObjects[x].draw(b,this.backBufferContext2D,this.xScroll,this.yScroll);this.context2D.drawImage(this.backBuffer,0,0)},this.addGameObject=function(a){this.gameObjects.push(a),this.gameObjects.sort(function(a,b){return a.zOrder-b.zOrder})},this.removeGameObject=function(a){this.gameObjects.removeObject(a)}}function initCanvas(){(new GameObjectManager).startupGameObjectManager()}VisualGameObject.prototype=new GameObject,RepeatingGameObject.prototype=new VisualGameObject,AnimatedGameObject.prototype=new VisualGameObject,Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)},Array.prototype.removeObject=function(a){for(var b=0;b<this.length;++b)if(this[b]===a){this.remove(b);break}};