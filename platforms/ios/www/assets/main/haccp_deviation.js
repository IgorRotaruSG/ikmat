function haccp_deviationInit(){if(console.log("haccp_deviationInit"),User.isLogged()){get=Page.get();var a={client:User.client,token:User.lastToken,task_id:get.id};if(isOffline()){var b=db.getDbInstance();b.transaction(function(a){a.executeSql('SELECT "taskData" FROM "tasks" WHERE "id"=?',get.id,function(a,b){""!=b.rows.item(0).taskData&&null!=b.rows.item(0).taskData?getTaskData(JSON.parse(b.rows.item(0).taskData)):($("#alertPopup .alert-text").html($.t("error.no_internet_for_sync")),$("#alertPopup").off("popupafterclose").on("popupafterclose",function(){}),$("#alertPopup").popup("open",{positionTo:"window"}))})}),haccpDeviation(a)}else Page.apiCall("deviation",a,"get","haccpDeviation")}else Page.redirect("login.html")}function haccpDeviation(a){var b=!1;if(a.form_deviation){var c=a.form_deviation,d="";for(var e in c)if(c.hasOwnProperty(e))switch(c[e].type){case"textarea":c[e].value||(c[e].value=""),d+=Form.textarea(e,c[e].label,c[e].placeholder,c[e].validation,c[e].value);break;case"date":d+=HTML.inputDate(e,c[e].label,c[e].placeholder,null,!0,c[e].validation);break;case"select":d+=HTML.selectBox(e,c[e].label,c[e].list,"",c[e].validation);break;case"file":d+=Form.fileBox(e,c[e].label);break;case"signature":b=!0,d+=Form.signature(e,c[e].label)}console.log("111 haccp_deviation.js"),d+=Form.submitHACCP(),$("#"+$.mobile.activePage.attr("id")+" #form_haccp_deviation").html(d),$("#"+$.mobile.activePage.attr("id")+" #form_haccp_deviation").off("submit").on("submit",function(a){a.preventDefault();var b=Form.validate($(this));if(b){var c=Form.getValues($(this)),d={client:User.client,token:User.lastToken,task_id:get.id,form:JSON.stringify(c)};Page.apiCall("deviation",d,"get","haccpDeviationSave2"),uploadHACCPPictureHaccpDev()}return!1}),$("#"+$.mobile.activePage.attr("id")+" #signature-trigger").off("click").on("click",function(a){return a.preventDefault(),openSignaturePopup(),$(document).off("click","#deviation-signature-close").on("click","#deviation-signature-close",function(){$("#signature_pop").popup("close");var a={client:User.client,token:User.lastToken,signature:JSON.stringify({name:$("#sign_name").val(),svg:$sigdiv.jSignature("getData","svgbase64")[1],parameter:"task",task_id:get.id})};Page.apiCall("documentSignature",a,"post","documentSignature")}),!1}),$("#"+$.mobile.activePage.attr("id")).trigger("create")}else $("#alertPopup .alert-text").html($.t("error.404")),$("#alertPopup").off("popupafterclose").on("popupafterclose",function(){Page.redirect("index.html")}),$("#alertPopup").popup("open",{positionTo:"window"})}function documentSignature(a){console.log("signature:"),$("#sign_name").attr("disabled",!0),$("#signature-trigger").attr("disabled",!0),$("#signature-trigger").val(a.current_time.date).button("refresh")}function selectHACCPPicture(a){Page.selectImage(a,function(b){$("#"+a).css({visibility:"visible",display:"block"}).attr("src",b)})}function uploadHACCPPictureHaccpDev(){var a=$("#"+haccp_image_id),b=a.attr("src");Page.uploadImage(b,function(b){a.css({visibility:"hidden",display:"none"}).attr("src","")})}function takeHACCPPicture(a){navigator.camera.getPicture(function(b){$("#"+a).css({visibility:"visible",display:"block"}).attr("src",b)},function(a){console.log("Error getting picture: "+a)},{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI})}function haccpDeviationSave2(a){void 0!=get.return_haccp_id?Page.redirect("haccp.html?continue="+get.return_haccp_id):Page.redirect("tasks.html")}var get,$sigdiv,haccp_image_id;$(window).on("orientationchange",function(a){$sigdiv.jSignature("reset"),$(".ui-popup-container").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px",overflow:"hidden",position:"fixed"}),setTimeout(function(){$("#signature_pop-popup").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px"}),console.log("asd")},500)});