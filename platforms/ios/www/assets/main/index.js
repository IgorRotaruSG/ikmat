function getUserHandle(a,b){var c,d,e,f,g=!0;if(a)g=!1;else for(var h=0;h<b.rows.length;h++){if(b.rows[h].error){g=!1;break}switch(b.rows[h].key){case"token":c=b.rows[h].doc.value;break;case"client":d=b.rows[h].doc.value;break;case"name":e=b.rows[h].doc.value;break;case"role":f=b.rows[h].doc.value}}g?(localStorage.setItem("user_name",e),localStorage.setItem("role",f),User.login(d,c)):Page.redirect("login.html")}function indexInit(){db.getDbInstance("settings").allDocs({keys:["token","client","name","role"],include_docs:!0},getUserHandle),executeSyncQuery(),document.addEventListener("resume",function(){var a=$.mobile.activePage.attr("id");"tasks"==a&&getTasks()},!1)}