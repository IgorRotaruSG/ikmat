!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.PouchDB=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}return a.call(this,[])}}b.exports=d},{}],2:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a(3),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{3:3}],3:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a(9),c.names=[],c.skips=[],c.formatters={};var j,k=0},{9:9}],4:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],5:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],7:[function(a,b,c){(function(a){a("object"==typeof c?c:this)}).call(this,function(a){var b=Array.prototype.slice,c=Array.prototype.forEach,d=function(a){if("object"!=typeof a)throw a+" is not an object";var e=b.call(arguments,1);return c.call(e,function(b){if(b)for(var c in b)"object"==typeof b[c]&&a[c]?d.call(a,a[c],b[c]):a[c]=b[c]}),a};a.extend=d})},{}],8:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(5),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=c=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},c.resolve=k,c.reject=l,c.all=m,c.race=n},{5:5}],9:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],10:[function(a,b,c){"use strict";function d(a){if(null!==a)switch(typeof a){case"boolean":return a?1:0;case"number":return k(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),d=b?a:Object.keys(a),e=-1,f=d.length,g="";if(b)for(;++e<f;)g+=c.toIndexableString(d[e]);else for(;++e<f;){var h=d[e];g+=c.toIndexableString(h)+c.toIndexableString(a[h])}return g}return""}function e(a,b){var c,d=b,e="1"===a[b];if(e)c=0,b++;else{var f="0"===a[b];b++;var g="",h=a.substring(b,b+m),i=parseInt(h,10)+l;for(f&&(i=-i),b+=m;;){var j=a[b];if("\x00"===j)break;g+=j,b++}g=g.split("."),c=1===g.length?parseInt(g,10):parseFloat(g[0]+"."+g[1]),f&&(c-=10),0!==i&&(c=parseFloat(c+"e"+i))}return{num:c,length:b-d}}function f(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function g(a,b){for(var d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c.collate(a[e],b[e]);if(0!==f)return f}return a.length===b.length?0:a.length>b.length?1:-1}function h(a,b){return a===b?0:a>b?1:-1}function i(a,b){for(var d=Object.keys(a),e=Object.keys(b),f=Math.min(d.length,e.length),g=0;f>g;g++){var h=c.collate(d[g],e[g]);if(0!==h)return h;if(h=c.collate(a[d[g]],b[e[g]]),0!==h)return h}return d.length===e.length?0:d.length>e.length?1:-1}function j(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);return~c?null===a?1:Array.isArray(a)?5:3>c?c+2:c+3:Array.isArray(a)?5:void 0}function k(a){if(0===a)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=0>a,e=d?"0":"2",f=(d?-c:c)-l,g=o.padLeft(f.toString(),"0",m);e+=n+g;var h=Math.abs(parseFloat(b[0]));d&&(h=10-h);var i=h.toFixed(20);return i=i.replace(/\.?0+$/,""),e+=n+i}var l=-324,m=3,n="",o=a(11);c.collate=function(a,b){if(a===b)return 0;a=c.normalizeKey(a),b=c.normalizeKey(b);var d=j(a),e=j(b);if(d-e!==0)return d-e;if(null===a)return 0;switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:b>a?-1:1;case"string":return h(a,b)}return Array.isArray(a)?g(a,b):i(a,b)},c.normalizeKey=function(a){switch(typeof a){case"undefined":return null;case"number":return a===1/0||a===-(1/0)||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var d=a.length;a=new Array(d);for(var e=0;d>e;e++)a[e]=c.normalizeKey(b[e])}else{if(a instanceof Date)return a.toJSON();if(null!==a){a={};for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];"undefined"!=typeof g&&(a[f]=c.normalizeKey(g))}}}}return a},c.toIndexableString=function(a){var b="\x00";return a=c.normalizeKey(a),j(a)+n+d(a)+b},c.parseIndexableString=function(a){for(var b=[],c=[],d=0;;){var g=a[d++];if("\x00"!==g)switch(g){case"1":b.push(null);break;case"2":b.push("1"===a[d]),d++;break;case"3":var h=e(a,d);b.push(h.num),d+=h.length;break;case"4":for(var i="";;){var j=a[d];if("\x00"===j)break;i+=j,d++}i=i.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(i);break;case"5":var k={element:[],index:b.length};b.push(k.element),c.push(k);break;case"6":var l={element:{},index:b.length};b.push(l.element),c.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+g)}else{if(1===b.length)return b.pop();f(b,c)}}}},{11:11}],11:[function(a,b,c){"use strict";function d(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}c.padLeft=function(a,b,c){var e=d(a,b,c);return e+a},c.padRight=function(a,b,c){var e=d(a,b,c);return a+e},c.stringLexCompare=function(a,b){var c,d=a.length,e=b.length;for(c=0;d>c;c++){if(c===e)return 1;var f=a.charAt(c),g=b.charAt(c);if(f!==g)return g>f?-1:1}return e>d?-1:0},c.intToDecimalForm=function(a){var b=0>a,c="";do{var d=b?-Math.ceil(a%10):Math.floor(a%10);c=d+c,a=b?Math.ceil(a/10):Math.floor(a/10)}while(a);return b&&"0"!==c&&(c="-"+c),c}},{}],12:[function(a,b,c){"use strict";function d(){this.store={}}function e(a){if(this.store=new d,a&&Array.isArray(a))for(var b=0,c=a.length;c>b;b++)this.add(a[b])}c.Map=d,c.Set=e,d.prototype.mangle=function(a){if("string"!=typeof a)throw new TypeError("key must be a string but Got "+a);return"$"+a},d.prototype.unmangle=function(a){return a.substring(1)},d.prototype.get=function(a){var b=this.mangle(a);return b in this.store?this.store[b]:void 0},d.prototype.set=function(a,b){var c=this.mangle(a);return this.store[c]=b,!0},d.prototype.has=function(a){var b=this.mangle(a);return b in this.store},d.prototype["delete"]=function(a){var b=this.mangle(a);return b in this.store?(delete this.store[b],!0):!1},d.prototype.forEach=function(a){for(var b=Object.keys(this.store),c=0,d=b.length;d>c;c++){var e=b[c],f=this.store[e];e=this.unmangle(e),a(f,e)}},e.prototype.add=function(a){return this.store.set(a,!0)},e.prototype.has=function(a){return this.store.has(a)},e.prototype["delete"]=function(a){return this.store["delete"](a)}},{}],13:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],14:[function(a,b,c){(function(){var a={}.hasOwnProperty,c=[].slice;b.exports=function(b,d){var e,f,g,h;f=[],h=[];for(e in d)a.call(d,e)&&(g=d[e],"this"!==e&&(f.push(e),h.push(g)));return Function.apply(null,c.call(f).concat([b])).apply(d["this"],h)}}).call(this)},{}],15:[function(b,c,d){!function(b){if("object"==typeof d)c.exports=b();else if("function"==typeof a&&a.amd)a(b);else{var e;try{e=window}catch(f){e=self}e.SparkMD5=b()}}(function(a){"use strict";function b(a,b,c,d,e,f){return b=t(t(b,a),t(d,f)),t(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=t(g,a[0]),a[1]=t(h,a[1]),a[2]=t(i,a[2]),a[3]=t(j,a[3])}function h(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c}function j(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k}function k(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k}function l(a){var b,c="";for(b=0;4>b;b+=1)c+=u[a>>8*b+4&15]+u[a>>8*b&15];return c}function m(a){var b;for(b=0;b<a.length;b+=1)a[b]=l(a[b]);return a.join("")}function n(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function o(a,b){var c,d=a.length,e=new ArrayBuffer(d),f=new Uint8Array(e);for(c=0;d>c;c+=1)f[c]=a.charCodeAt(c);return b?f:e}function p(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function q(a,b,c){var d=new Uint8Array(a.byteLength+b.byteLength);return d.set(new Uint8Array(a)),d.set(new Uint8Array(b),a.byteLength),c?d:d.buffer}function r(a){var b,c=[],d=a.length;for(b=0;d-1>b;b+=2)c.push(parseInt(a.substr(b,2),16));return String.fromCharCode.apply(String,c)}function s(){this.reset()}var t=function(a,b){return a+b&4294967295},u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==m(j("hello"))&&(t=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function b(a,b){return a=0|a||0,0>a?Math.max(a+b,0):Math.min(a,b)}ArrayBuffer.prototype.slice=function(c,d){var e,f,g,h,i=this.byteLength,j=b(c,i),k=i;return d!==a&&(k=b(d,i)),j>k?new ArrayBuffer(0):(e=k-j,f=new ArrayBuffer(e),g=new Uint8Array(f),h=new Uint8Array(this,j,e),g.set(h),f)}}(),s.prototype.append=function(a){return this.appendBinary(n(a)),this},s.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)g(this._hash,h(this._buff.substring(b-64,b)));return this._buff=this._buff.substring(b-64),this},s.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},s.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},s.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},s.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(g(this._hash,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,g(this._hash,a)},s.hash=function(a,b){return s.hashBinary(n(a),b)},s.hashBinary=function(a,b){var c=j(a),d=m(c);return b?r(d):d},s.ArrayBuffer=function(){this.reset()},s.ArrayBuffer.prototype.append=function(a){var b,c=q(this._buff.buffer,a,!0),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)g(this._hash,i(c.subarray(b-64,b)));return this._buff=d>b-64?new Uint8Array(c.buffer.slice(b-64)):new Uint8Array(0),this},s.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.ArrayBuffer.prototype.getState=function(){var a=s.prototype.getState.call(this);return a.buff=p(a.buff),a},s.ArrayBuffer.prototype.setState=function(a){return a.buff=o(a.buff,!0),s.prototype.setState.call(this,a)},s.ArrayBuffer.prototype.destroy=s.prototype.destroy,s.ArrayBuffer.prototype._finish=s.prototype._finish,s.ArrayBuffer.hash=function(a,b){var c=k(new Uint8Array(a)),d=m(c);return b?r(d):d},s})},{}],16:[function(a,b,c){"use strict";function d(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}c.stringify=function(a){var b=[];b.push({obj:a});for(var c,d,e,f,g,h,i,j,k,l,m,n="";c=b.pop();)if(d=c.obj,e=c.prefix||"",f=c.val||"",n+=e,f)n+=f;else if("object"!=typeof d)n+="undefined"==typeof d?null:JSON.stringify(d);else if(null===d)n+="null";else if(Array.isArray(d)){for(b.push({val:"]"}),g=d.length-1;g>=0;g--)h=0===g?"":",",b.push({obj:d[g],prefix:h});b.push({val:"["})}else{i=[];for(j in d)d.hasOwnProperty(j)&&i.push(j);for(b.push({val:"}"}),g=i.length-1;g>=0;g--)k=i[g],l=d[k],m=g>0?",":"",m+=JSON.stringify(k)+":",b.push({obj:l,prefix:m});b.push({val:"{"})}return n},c.parse=function(a){for(var b,c,e,f,g,h,i,j,k,l=[],m=[],n=0;;)if(b=a[n++],"}"!==b&&"]"!==b&&"undefined"!=typeof b)switch(b){case" ":case"	":case"\n":case":":case",":break;case"n":n+=3,d(null,l,m);break;case"t":n+=3,d(!0,l,m);break;case"f":n+=4,d(!1,l,m);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(c="",n--;;){if(e=a[n++],!/[\d\.\-e\+]/.test(e)){n--;break}c+=e}d(parseFloat(c),l,m);break;case'"':for(f="",g=void 0,h=0;i=a[n++],'"'!==i||"\\"===g&&h%2===1;)f+=i,g=i,"\\"===g?h++:h=0;d(JSON.parse('"'+f+'"'),l,m);break;case"[":j={element:[],index:l.length},l.push(j.element),m.push(j);break;case"{":k={element:{},index:l.length},l.push(k.element),m.push(k);break;default:throw new Error("unexpectedly reached end of input: "+b)}else{if(1===l.length)return l.pop();d(l.pop(),l,m)}}},{}],17:[function(a,b,c){(function(c,d){"use strict";function e(a){return"default"in a?a["default"]:a}function f(a,b){for(var c={},d=0,e=b.length;e>d;d++){var f=b[d];f in a&&(c[f]=a[f])}return c}function g(a){return a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob}function h(a){if("function"==typeof a.slice)return a.slice(0);var b=new ArrayBuffer(a.byteLength),c=new Uint8Array(b),d=new Uint8Array(a);return c.set(d),b}function i(a){if(a instanceof ArrayBuffer)return h(a);var b=a.size,c=a.type;return"function"==typeof a.slice?a.slice(0,b,c):a.webkitSlice(0,b,c)}function j(a){var b,c,d;if(!a||"object"!=typeof a)return a;if(Array.isArray(a)){for(b=[],c=0,d=a.length;d>c;c++)b[c]=j(a[c]);return b}if(a instanceof Date)return a.toISOString();if(g(a))return i(a);b={};for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var e=j(a[c]);"undefined"!=typeof e&&(b[c]=e)}return b}function k(a){var b=!1;return Zc(function(c){if(b)throw new Error("once called more than once");b=!0,a.apply(this,c)})}function l(a){return Zc(function(b){b=j(b);var d,e=this,f="function"==typeof b[b.length-1]?b.pop():!1;f&&(d=function(a,b){c.nextTick(function(){f(a,b)})});var g=new fd(function(c,d){var f;try{var g=k(function(a,b){a?d(a):c(b)});b.push(g),f=a.apply(e,b),f&&"function"==typeof f.then&&c(f)}catch(h){d(h)}});return d&&g.then(function(a){d(null,a)},d),g})}function m(a,b){function c(a,b,c){if(gd.enabled){for(var d=[a._db_name,b],e=0;e<c.length-1;e++)d.push(c[e]);gd.apply(null,d);var f=c[c.length-1];c[c.length-1]=function(c,d){var e=[a._db_name,b];e=e.concat(c?["error",c]:["success",d]),gd.apply(null,e),f(c,d)}}}return l(Zc(function(d){if(this._closed)return fd.reject(new Error("database is closed"));var e=this;return c(e,a,d),this.taskqueue.isReady?b.apply(this,d):new fd(function(b,c){e.taskqueue.addTask(function(f){f?c(f):b(e[a].apply(e,d))})})}))}function n(a,b,c){return new fd(function(d,e){a.get(b,function(f,g){if(f){if(404!==f.status)return e(f);g={}}var h=g._rev,i=c(g);return i?(i._id=b,i._rev=h,void d(o(a,i,c))):d({updated:!1,rev:h})})})}function o(a,b,c){return a.put(b).then(function(a){return{updated:!0,rev:a.rev}},function(d){if(409!==d.status)throw d;return n(a,b._id,c)})}function p(a){for(var b,c,d,e,f=a.rev_tree.slice();e=f.pop();){var g=e.ids,h=g[2],i=e.pos;if(h.length)for(var j=0,k=h.length;k>j;j++)f.push({pos:i+1,ids:h[j]});else{var l=!!g[1].deleted,m=g[0];(!b||(d!==l?d:c!==i?i>c:m>b))&&(b=m,c=i,d=l)}}return c+"-"+b}function q(a){return a.ids}function r(a,b){b||(b=p(a));for(var c,d=b.substring(b.indexOf("-")+1),e=a.rev_tree.map(q);c=e.pop();){if(c[0]===d)return!!c[1].deleted;e=e.concat(c[2])}}function s(a){return cd("return "+a+";",{})}function t(a){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+a+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function u(a){if(!a)return null;var b=a.split("/");return 2===b.length?b:1===b.length?[a,a]:null}function v(a){var b=u(a);return b?b.join("/"):null}function w(a,b){for(var c,d=a.slice();c=d.pop();)for(var e=c.pos,f=c.ids,g=f[2],h=b(0===g.length,e,f[0],c.ctx,f[1]),i=0,j=g.length;j>i;i++)d.push({pos:e+1,ids:g[i],ctx:h})}function x(a,b){return a.pos-b.pos}function y(a){var b=[];w(a,function(a,c,d,e,f){a&&b.push({rev:c+"-"+d,pos:c,opts:f})}),b.sort(x).reverse();for(var c=0,d=b.length;d>c;c++)delete b[c].pos;return b}function z(a){for(var b=p(a),c=y(a.rev_tree),d=[],e=0,f=c.length;f>e;e++){var g=c[e];g.rev===b||g.opts.deleted||d.push(g.rev)}return d}function A(a){Error.call(this,a.reason),this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}function B(a,b,c){function d(b){for(var d in a)"function"!=typeof a[d]&&(this[d]=a[d]);void 0!==c&&(this.name=c),void 0!==b&&(this.reason=b)}return d.prototype=A.prototype,new d(b)}function C(a){var b,c,d,e,f;return c=a.error===!0&&"string"==typeof a.name?a.name:a.error,f=a.reason,d=Gd("name",c,f),a.missing||"missing"===f||"deleted"===f||"not_found"===c?d=jd:"doc_validation"===c?(d=td,
e=f):"bad_request"===c&&d.message!==f&&(d=ud),d||(d=Gd("status",a.status,f)||pd),b=B(d,f,c),e&&(b.message=e),a.id&&(b.id=a.id),a.status&&(b.status=a.status),a.missing&&(b.missing=a.missing),b}function D(a,b,c){function d(){e.cancel()}Yc.EventEmitter.call(this);var e=this;this.db=a,b=b?j(b):{};var f=b.complete=k(function(b,c){b?e.emit("error",b):e.emit("complete",c),e.removeAllListeners(),a.removeListener("destroyed",d)});c&&(e.on("complete",function(a){c(null,a)}),e.on("error",c)),a.once("destroyed",d),b.onChange=function(a){b.isCancelled||(e.emit("change",a),e.startSeq&&e.startSeq<=a.seq&&(e.startSeq=!1))};var g=new fd(function(a,c){b.complete=function(b,d){b?c(b):a(d)}});e.once("cancel",function(){a.removeListener("destroyed",d),b.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this["catch"]=g["catch"].bind(g),this.then(function(a){f(null,a)},f),a.taskqueue.isReady?e.doChanges(b):a.taskqueue.addTask(function(){e.isCancelled?e.emit("cancel"):e.doChanges(b)})}function E(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=y(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return r(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=z(b),e.doc._conflicts.length||delete e.doc._conflicts),e}function F(a,b,c){function d(){var a=[];l.forEach(function(b){b.docs.forEach(function(c){a.push({id:b.id,docs:[c]})})}),c(null,{results:a})}function e(){++k===j&&d()}function g(a,b,c){l[a]={id:b,docs:c},e()}var h=Array.isArray(b)?b:b.docs,i={};h.forEach(function(a){a.id in i?i[a.id].push(a):i[a.id]=[a]});var j=Object.keys(i).length,k=0,l=new Array(j);Object.keys(i).forEach(function(c,d){var e=i[c],h=f(e[0],["atts_since","attachments"]);h.open_revs=e.map(function(a){return a.rev}),h.open_revs=h.open_revs.filter(function(a){return a});var j=function(a){return a};0===h.open_revs.length&&(delete h.open_revs,j=function(a){return[{ok:a}]}),["revs","attachments","binary"].forEach(function(a){a in b&&(h[a]=b[a])}),a.get(c,h,function(a,b){g(d,c,a?[{error:a}]:j(b))})})}function G(a){return/^_local/.test(a)}function H(a){for(var b,c=[],d=a.slice();b=d.pop();){var e=b.pos,f=b.ids,g=f[0],h=f[1],i=f[2],j=0===i.length,k=b.history?b.history.slice():[];k.push({id:g,opts:h}),j&&c.push({pos:e+1-k.length,ids:k});for(var l=0,m=i.length;m>l;l++)d.push({pos:e+1,ids:i[l],history:k})}return c.reverse()}function I(a){return 0|Math.random()*a}function J(a,b){b=b||Hd.length;var c="",d=-1;if(a){for(;++d<a;)c+=Hd[I(b)];return c}for(;++d<36;)switch(d){case 8:case 13:case 18:case 23:c+="-";break;case 19:c+=Hd[3&I(16)|8];break;default:c+=Hd[I(16)]}return c}function K(a){return a.reduce(function(a,b){return a[b]=!0,a},{})}function L(a){var b;if(a?"string"!=typeof a?b=B(ld):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=B(nd)):b=B(md),b)throw b}function M(a){if(!/^\d+\-./.test(a))return B(Bd);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function N(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;g>f;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}function O(a,b){var c,d,e,f={status:"available"};if(a._deleted&&(f.deleted=!0),b)if(a._id||(a._id=J()),d=J(32,16).toLowerCase(),a._rev){if(e=M(a._rev),e.error)return e;a._rev_tree=[{pos:e.prefix,ids:[e.id,{status:"missing"},[[d,f,[]]]]}],c=e.prefix+1}else a._rev_tree=[{pos:1,ids:[d,f,[]]}],c=1;else if(a._revisions&&(a._rev_tree=N(a._revisions,f),c=a._revisions.start,d=a._revisions.ids[0]),!a._rev_tree){if(e=M(a._rev),e.error)return e;c=e.prefix,d=e.id,a._rev_tree=[{pos:c,ids:[d,f,[]]}]}L(a._id),a._rev=c+"-"+d;var g={metadata:{},data:{}};for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)){var i="_"===h[0];if(i&&!Id[h]){var j=B(td,h);throw j.message=td.message+": "+h,j}i&&!Jd[h]?g.metadata[h.slice(1)]=a[h]:g.data[h]=a[h]}return g}function P(a,b){return b>a?-1:a>b?1:0}function Q(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c)===!0)return a[c]}function R(a){return function(b,c){b||c[0]&&c[0].error?a(b||c[0]):a(null,c.length?c[0]:c)}}function S(a){for(var b=0;b<a.length;b++){var c=a[b];if(c._deleted)delete c._attachments;else if(c._attachments)for(var d=Object.keys(c._attachments),e=0;e<d.length;e++){var g=d[e];c._attachments[g]=f(c._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}function T(a,b){var c=P(a._id,b._id);if(0!==c)return c;var d=a._revisions?a._revisions.start:0,e=b._revisions?b._revisions.start:0;return P(d,e)}function U(a){var b={},c=[];return w(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){void 0===b[a.from]?b[a.from]=1+b[a.to]:b[a.from]=Math.min(b[a.from],1+b[a.to])}),b}function V(a,b,c){var d="limit"in b?b.keys.slice(b.skip,b.limit+b.skip):b.skip>0?b.keys.slice(b.skip):b.keys;if(b.descending&&d.reverse(),!d.length)return a._allDocs({limit:0},c);var e={offset:b.skip};return fd.all(d.map(function(c){var d=Uc.extend({key:c,deleted:"ok"},b);return["limit","skip","keys"].forEach(function(a){delete d[a]}),new fd(function(b,f){a._allDocs(d,function(a,d){return a?f(a):(e.total_rows=d.total_rows,void b(d.rows[0]||{key:c,error:"not_found"}))})})})).then(function(a){return e.rows=a,e})}function W(a){var b=a._compactionQueue[0],d=b.opts,e=b.callback;a.get("_local/compaction")["catch"](function(){return!1}).then(function(b){b&&b.last_seq&&(d.last_seq=b.last_seq),a._compact(d,function(b,d){b?e(b):e(null,d),c.nextTick(function(){a._compactionQueue.shift(),a._compactionQueue.length&&W(a)})})})}function X(a){return"_"===a.charAt(0)?a+"is not a valid attachment name, attachment names cannot start with '_'":!1}function Y(){Yc.EventEmitter.call(this)}function Z(){this.isReady=!1,this.failed=!1,this.queue=[]}function $(a){a&&d.debug&&console.error(a)}function _(a,b){function c(){f.emit("destroyed",e),f.emit(e,"destroyed")}function d(){a.removeListener("destroyed",c),a.emit("destroyed",a)}var e=b.originalName,f=a.constructor,g=f._destructionListeners;a.once("destroyed",c),g.has(e)||g.set(e,[]),g.get(e).push(d)}function aa(a,b,c){if(!(this instanceof aa))return new aa(a,b,c);var d=this;("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),a&&"object"==typeof a&&(b=a,a=void 0),"undefined"==typeof c&&(c=$),a=a||b.name,b=j(b),delete b.name,this.__opts=b;var e=c;d.auto_compaction=b.auto_compaction,d.prefix=aa.prefix,Y.call(d),d.taskqueue=new Z;var f=new fd(function(e,f){c=function(a,b){return a?f(a):(delete b.then,void e(b))},b=j(b);var g,h,i=b.name||a;return function(){try{if("string"!=typeof i)throw h=new Error("Missing/invalid DB name"),h.code=400,h;if(g=aa.parseAdapter(i,b),b.originalName=i,b.name=g.name,b.prefix&&"http"!==g.adapter&&"https"!==g.adapter&&(b.name=b.prefix+b.name),b.adapter=b.adapter||g.adapter,d._adapter=b.adapter,$c("pouchdb:adapter")("Picked adapter: "+b.adapter),d._db_name=i,!aa.adapters[b.adapter])throw h=new Error("Adapter is missing"),h.code=404,h;if(!aa.adapters[b.adapter].valid())throw h=new Error("Invalid Adapter"),h.code=404,h}catch(a){d.taskqueue.fail(a)}}(),h?f(h):(d.adapter=b.adapter,d.replicate={},d.replicate.from=function(a,b,c){return d.constructor.replicate(a,d,b,c)},d.replicate.to=function(a,b,c){return d.constructor.replicate(d,a,b,c)},d.sync=function(a,b,c){return d.constructor.sync(d,a,b,c)},d.replicate.sync=d.sync,void aa.adapters[b.adapter].call(d,b,function(a){return a?(d.taskqueue.fail(a),void c(a)):(_(d,b),d.emit("created",d),aa.emit("created",b.originalName),d.taskqueue.ready(d),void c(null,d))}))});f.then(function(a){e(null,a)},e),d.then=f.then.bind(f),d["catch"]=f["catch"].bind(f)}function ba(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function ca(){return Kd}function da(a){Object.keys(Yc.EventEmitter.prototype).forEach(function(b){"function"==typeof Yc.EventEmitter.prototype[b]&&(a[b]=Md[b].bind(Md))});var b=a._destructionListeners=new Xc.Map;a.on("destroyed",function(a){b.has(a)&&(b.get(a).forEach(function(a){a()}),b["delete"](a))})}function ea(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(c){if("TypeError"!==c.name)throw c;for(var d="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,e=new d,f=0;f<a.length;f+=1)e.append(a[f]);return e.getBlob(b.type)}}function fa(a,b){if("undefined"==typeof FileReader)return b((new FileReaderSync).readAsArrayBuffer(a));var c=new FileReader;c.onloadend=function(a){var c=a.target.result||new ArrayBuffer(0);b(c)},c.readAsArrayBuffer(a)}function ga(){for(var a={},b=new fd(function(b,c){a.resolve=b,a.reject=c}),c=new Array(arguments.length),d=0;d<c.length;d++)c[d]=arguments[d];return a.promise=b,fd.resolve().then(function(){return fetch.apply(null,c)}).then(function(b){a.resolve(b)})["catch"](function(b){a.reject(b)}),a}function ha(a,b){var c,d,e,f=new Headers,g={method:a.method,credentials:"include",headers:f};return a.json&&(f.set("Accept","application/json"),f.set("Content-Type",a.headers["Content-Type"]||"application/json")),a.body&&a.body instanceof Blob?fa(a.body,function(a){g.body=a}):a.body&&a.processData&&"string"!=typeof a.body?g.body=JSON.stringify(a.body):"body"in a?g.body=a.body:g.body=null,Object.keys(a.headers).forEach(function(b){a.headers.hasOwnProperty(b)&&f.set(b,a.headers[b])}),c=ga(a.url,g),a.timeout>0&&(d=setTimeout(function(){c.reject(new Error("Load timeout for resource: "+a.url))},a.timeout)),c.promise.then(function(b){return e={statusCode:b.status},a.timeout>0&&clearTimeout(d),e.statusCode>=200&&e.statusCode<300?a.binary?b.blob():b.text():b.json()}).then(function(a){e.statusCode>=200&&e.statusCode<300?b(null,e,a):b(a,e)})["catch"](function(a){b(a,e)}),{abort:c.reject}}function ia(a,b){var c,d,e=function(){c.abort()};c=a.xhr?new a.xhr:new XMLHttpRequest;try{c.open(a.method,a.url)}catch(f){b(f,{statusCode:413})}c.withCredentials="withCredentials"in a?a.withCredentials:!0,"GET"===a.method?delete a.headers["Content-Type"]:a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(c.responseType="arraybuffer"),"body"in a||(a.body=null);for(var g in a.headers)a.headers.hasOwnProperty(g)&&c.setRequestHeader(g,a.headers[g]);return a.timeout>0&&(d=setTimeout(e,a.timeout),c.onprogress=function(){clearTimeout(d),d=setTimeout(e,a.timeout)},"undefined"!=typeof c.upload&&(c.upload.onprogress=c.onprogress)),c.onreadystatechange=function(){if(4===c.readyState){var d={statusCode:c.status};if(c.status>=200&&c.status<300){var e;e=a.binary?ea([c.response||""],{type:c.getResponseHeader("Content-Type")}):c.responseText,b(null,d,e)}else{var f={};try{f=JSON.parse(c.response)}catch(g){}b(f,d)}}},a.body&&a.body instanceof Blob?fa(a.body,function(a){c.send(a)}):c.send(a.body),{abort:e}}function ja(){try{return new XMLHttpRequest,!0}catch(a){return!1}}function ka(a,b){return Nd||a.xhr?ia(a,b):ha(a,b)}function la(){return""}function ma(a,b){function c(b,c,d){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(e){return d(e)}Array.isArray(b)&&(b=b.map(function(a){return a.error||a.missing?C(a):a})),a.binary&&Od(b,c),d(null,b,c)}function d(a,b){var c,d;if(a.code&&a.status){var e=new Error(a.message||a.code);return e.status=a.status,b(e)}try{c=JSON.parse(a.responseText),d=C(c)}catch(f){d=C(a)}b(d)}a=j(a);var e={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return a=Uc.extend(e,a),a.json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),ka(a,function(e,f,g){if(e)return e.status=f?f.statusCode:400,d(e,b);var h,i=f.headers&&f.headers["content-type"],j=g||la();if(!a.binary&&(a.json||!a.processData)&&"object"!=typeof j&&(/json/.test(i)||/^[\s]*\{/.test(j)&&/\}[\s]*$/.test(j)))try{j=JSON.parse(j.toString())}catch(k){}f.statusCode>=200&&f.statusCode<300?c(j,f,b):(h=C(j),h.status=f.statusCode,b(h))})}function na(a,b){var c=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",d=-1!==c.indexOf("safari")&&-1===c.indexOf("chrome"),e=-1!==c.indexOf("msie"),f=d&&"POST"===a.method||e&&"GET"===a.method,g="cache"in a?a.cache:!0;if(f||!g){var h=-1!==a.url.indexOf("?");a.url+=(h?"&":"?")+"_nonce="+Date.now()}return ma(a,b)}function oa(a){for(var b=Sd.exec(a),c={},d=14;d--;){var e=Pd[d],f=b[d]||"",g=-1!==["user","password"].indexOf(e);c[e]=g?decodeURIComponent(f):f}return c[Qd]={},c[Pd[12]].replace(Rd,function(a,b,d){b&&(c[Qd][b]=d)}),c}function pa(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;b>e;e++)d[e]=a.charCodeAt(e);return c}function qa(a,b){return ea([pa(a)],{type:b})}function ra(a,b,c){try{return!a(b,c)}catch(d){var e="Filter function threw: "+d.toString();return B(ud,e)}}function sa(a){var b={},c=a.filter&&"function"==typeof a.filter;return b.query=a.query_params,function(d){d.doc||(d.doc={});var e=c&&ra(a.filter,d.doc,b);if("object"==typeof e)return e;if(e)return!1;if(a.include_docs){if(!a.attachments)for(var f in d.doc._attachments)d.doc._attachments.hasOwnProperty(f)&&(d.doc._attachments[f].stub=!0)}else delete d.doc;return!0}}function ta(a,b){"console"in d&&"info"in console&&console.info("The above "+a+" is totally normal. "+b)}function ua(a,b,c,d,e){return a.get(b)["catch"](function(c){if(404===c.status)return"http"===a.type()&&ta(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:d,_id:b,history:[],replicator:Zd,version:Yd};throw c}).then(function(f){return e.cancelled?void 0:(f.history=(f.history||[]).filter(function(a){return a.session_id!==d}),f.history.unshift({last_seq:c,session_id:d}),f.history=f.history.slice(0,$d),f.version=Yd,f.replicator=Zd,f.session_id=d,f.last_seq=c,a.put(f)["catch"](function(f){if(409===f.status)return ua(a,b,c,d,e);throw f}))})}function va(a,b,c,d){this.src=a,this.target=b,this.id=c,this.returnValue=d}function wa(a,b){if(a.session_id===b.session_id)return{last_seq:a.last_seq,history:a.history||[]};var c=a.history||[],d=b.history||[];return xa(c,d)}function xa(a,b){var c=a[0],d=a.slice(1),e=b[0],f=b.slice(1);if(!c||0===b.length)return{last_seq:_d,history:[]};var g=c.session_id;if(ya(g,b))return{last_seq:c.last_seq,history:a};var h=e.session_id;return ya(h,d)?{last_seq:e.last_seq,history:f}:xa(d,f)}function ya(a,b){var c=b[0],d=b.slice(1);return a&&0!==b.length?a===c.session_id?!0:ya(a,d):!1}function za(a){return"number"==typeof a.status&&4===Math.floor(a.status/100)}function Aa(a,b){a=parseInt(a,10)||0,b=parseInt(b,10),b!==b||a>=b?b=(a||1)<<1:b+=1;var c=Math.random(),d=b-a;return~~(d*c+a)}function Ba(a){var b=0;return a||(b=2e3),Aa(a,b)}function Ca(a,b,c,d){return a.retry===!1?(b.emit("error",c),void b.removeAllListeners()):("function"!=typeof a.back_off_function&&(a.back_off_function=Ba),b.emit("requestError",c),("active"===b.state||"pending"===b.state)&&(b.emit("paused",c),b.state="stopped",b.once("active",function(){a.current_back_off=be})),a.current_back_off=a.current_back_off||be,a.current_back_off=a.back_off_function(a.current_back_off),void setTimeout(d,a.current_back_off))}function Da(a){return Ud(a)}function Ea(a,b,c,d){(c>0||d<b.byteLength)&&(b=new Uint8Array(b,c,Math.min(d,b.byteLength)-c)),a.append(b)}function Fa(a,b,c,d){(c>0||d<b.length)&&(b=b.substring(c,d)),a.appendBinary(b)}function Ga(a){return Object.keys(a).sort(_c.collate).reduce(function(b,c){return b[c]=a[c],b},{})}function Ha(a,b,c){var d=c.doc_ids?c.doc_ids.sort(_c.collate):"",e=c.filter?c.filter.toString():"",f="",g="";return c.filter&&c.query_params&&(f=JSON.stringify(Ga(c.query_params))),c.filter&&"_view"===c.filter&&(g=c.view.toString()),fd.all([a.id(),b.id()]).then(function(a){var b=a[0]+a[1]+e+g+f+d;return ee(b)}).then(function(a){return a=a.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+a})}function Ia(a){return/^1-/.test(a)}function Ja(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c].missing;d.forEach(function(a){b.push({id:c,rev:a})})}),{docs:b,revs:!0,attachments:!0,binary:!0}}function Ka(a,b,c){function d(){var d=Ja(b);return d.docs.length?a.bulkGet(d).then(function(a){if(c.cancelled)throw new Error("cancelled");a.results.forEach(function(a){a.docs.forEach(function(a){a.ok&&i.push(a.ok)})})}):void 0}function e(a){return a._attachments&&Object.keys(a._attachments).length>0}function f(d){return a.allDocs({keys:d,include_docs:!0}).then(function(a){if(c.cancelled)throw new Error("cancelled");a.rows.forEach(function(a){!a.deleted&&a.doc&&Ia(a.value.rev)&&!e(a.doc)&&(i.push(a.doc),delete b[a.id])})})}function g(){var a=Object.keys(b).filter(function(a){var c=b[a].missing;return 1===c.length&&Ia(c[0])});return a.length>0?f(a):void 0}function h(){return i}b=j(b);var i=[];return fd.resolve().then(g).then(d).then(h)}function La(a,b,c,d,e){function f(){return x?fd.resolve():Ha(a,b,c).then(function(c){w=c,x=new va(a,b,w,d)})}function g(){if(L=[],0!==v.docs.length){var a=v.docs;return b.bulkDocs({docs:a,new_edits:!1}).then(function(b){if(d.cancelled)throw o(),new Error("cancelled");var c=[],f={};b.forEach(function(a){a.error&&(e.doc_write_failures++,c.push(a),f[a.id]=a)}),K=K.concat(c),e.docs_written+=v.docs.length-c.length;var g=c.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(a.forEach(function(a){var b=f[a._id];b?d.emit("denied",j(b)):L.push(a)}),g.length>0){var h=new Error("bulkDocs error");throw h.other_errors=c,n("target.bulkDocs failed to write docs",h),new Error("bulkWrite partial failure")}},function(b){throw e.doc_write_failures+=a.length,b})}}function h(){e.last_seq=D=v.seq;var a=j(e);return L.length&&(a.docs=L,d.emit("change",a)),A=!0,x.writeCheckpoint(v.seq,M).then(function(){if(A=!1,d.cancelled)throw o(),new Error("cancelled");v=void 0,s()})["catch"](function(a){throw A=!1,n("writeCheckpoint completed with error",a),a})}function i(){var a={};return v.changes.forEach(function(b){"_user/"!==b.id&&(a[b.id]=b.changes.map(function(a){return a.rev}))}),b.revsDiff(a).then(function(a){if(d.cancelled)throw o(),new Error("cancelled");v.diffs=a})}function k(){return Ka(a,v.diffs,d).then(function(a){a.forEach(function(a){delete v.diffs[a._id],e.docs_read++,v.docs.push(a)})})}function l(){if(!d.cancelled&&!v){if(0===y.length)return void m(!0);v=y.shift(),i().then(k).then(g).then(h).then(l)["catch"](function(a){n("batch processing terminated with error",a)})}}function m(a){return 0===z.changes.length?void(0!==y.length||v||((E&&N.live||B)&&(d.state="pending",d.emit("paused")),B&&o())):void((a||B||z.changes.length>=F)&&(y.push(z),z={seq:0,changes:[],docs:[]},("pending"===d.state||"stopped"===d.state)&&(d.state="active",d.emit("active")),l()))}function n(a,b){C||(b.message||(b.message=a),e.ok=!1,e.status="aborting",e.errors.push(b),K=K.concat(b),y=[],z={seq:0,changes:[],docs:[]},o())}function o(){if(!(C||d.cancelled&&(e.status="cancelled",A))){e.status=e.status||"complete",e.end_time=new Date,e.last_seq=D,C=!0;var f=K.filter(function(a){return"unauthorized"!==a.name&&"forbidden"!==a.name});if(f.length>0){var g=K.pop();K.length>0&&(g.other_errors=K),g.result=e,Ca(c,d,g,function(){La(a,b,c,d)})}else e.errors=K,d.emit("complete",e),d.removeAllListeners()}}function p(a){if(d.cancelled)return o();var b=sa(c)(a);b&&(z.seq=a.seq,z.changes.push(a),m(N.live))}function q(a){return H=!1,d.cancelled?o():(a.results.length>0?(N.since=a.last_seq,s()):E?(N.live=!0,s()):B=!0,void m(!0))}function r(a){return H=!1,d.cancelled?o():void n("changes rejected",a)}function s(){function b(){f.cancel()}function e(){d.removeListener("cancel",b)}if(!H&&!B&&y.length<G){H=!0,d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",b);var f=a.changes(N).on("change",p);f.then(e,e),f.then(q)["catch"](r),c.retry&&(d._changes=f,d._abortChanges=b)}}function t(){f().then(function(){return d.cancelled?void o():x.getCheckpoint().then(function(a){D=a,N={since:D,limit:F,batch_size:F,style:"all_docs",doc_ids:I,return_docs:!0},c.filter&&("string"!=typeof c.filter?N.include_docs=!0:N.filter=c.filter),"heartbeat"in c&&(N.heartbeat=c.heartbeat),"timeout"in c&&(N.timeout=c.timeout),c.query_params&&(N.query_params=c.query_params),c.view&&(N.view=c.view),s()})})["catch"](function(a){n("getCheckpoint rejected with ",a)})}function u(a){throw A=!1,n("writeCheckpoint completed with error",a),a}var v,w,x,y=[],z={seq:0,changes:[],docs:[]},A=!1,B=!1,C=!1,D=0,E=c.continuous||c.live||!1,F=c.batch_size||100,G=c.batches_limit||10,H=!1,I=c.doc_ids,K=[],L=[],M=J();e=e||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var N={};return d.ready(a,b),d.cancelled?void o():(d._addedListeners||(d.once("cancel",o),"function"==typeof c.complete&&(d.once("error",c.complete),d.once("complete",function(a){c.complete(null,a)})),d._addedListeners=!0),void("undefined"==typeof c.since?t():f().then(function(){return A=!0,x.writeCheckpoint(c.since,M)}).then(function(){return A=!1,d.cancelled?void o():(D=c.since,void t())})["catch"](u)))}function Ma(){Yc.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new fd(function(b,c){a.once("complete",b),a.once("error",c)});a.then=function(a,c){return b.then(a,c)},a["catch"]=function(a){return b["catch"](a)},a["catch"](function(){})}function Na(a,b){var c=b.PouchConstructor;return"string"==typeof a?new c(a,b):a}function Oa(a,b,c,d){if("function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c.doc_ids&&!Array.isArray(c.doc_ids))throw B(ud,"`doc_ids` filter parameter is not a list.");c.complete=d,c=j(c),c.continuous=c.continuous||c.live,c.retry="retry"in c?c.retry:!1,c.PouchConstructor=c.PouchConstructor||this;var e=new Ma(c),f=Na(a,c),g=Na(b,c);return La(f,g,c,e),e}function Pa(a,b,c,d){return"function"==typeof c&&(d=c,c={}),"undefined"==typeof c&&(c={}),c=j(c),c.PouchConstructor=c.PouchConstructor||this,a=fe.toPouch(a,c),b=fe.toPouch(b,c),new Qa(a,b,c,d)}function Qa(a,b,c,d){function e(a){n.emit("change",{direction:"pull",change:a})}function f(a){n.emit("change",{direction:"push",change:a})}function g(a){n.emit("denied",{direction:"push",doc:a})}function h(a){n.emit("denied",{direction:"pull",doc:a})}function i(){n.pushPaused=!0,n.pullPaused&&n.emit("paused")}function j(){n.pullPaused=!0,n.pushPaused&&n.emit("paused")}function k(){n.pushPaused=!1,n.pullPaused&&n.emit("active",{direction:"push"})}function l(){n.pullPaused=!1,n.pushPaused&&n.emit("active",{direction:"pull"})}function m(a){return function(b,c){var d="change"===b&&(c===e||c===f),m="denied"===b&&(c===h||c===g),o="paused"===b&&(c===j||c===i),p="active"===b&&(c===l||c===k);(d||m||o||p)&&(b in q||(q[b]={}),q[b][a]=!0,2===Object.keys(q[b]).length&&n.removeAllListeners(b))}}var n=this;this.canceled=!1;var o=c.push?Uc.extend({},c,c.push):c,p=c.pull?Uc.extend({},c,c.pull):c;this.push=ge(a,b,o),this.pull=ge(b,a,p),this.pushPaused=!0,this.pullPaused=!0;var q={};c.live&&(this.push.on("complete",n.pull.cancel.bind(n.pull)),this.pull.on("complete",n.push.cancel.bind(n.push))),this.on("newListener",function(a){"change"===a?(n.pull.on("change",e),n.push.on("change",f)):"denied"===a?(n.pull.on("denied",h),n.push.on("denied",g)):"active"===a?(n.pull.on("active",l),n.push.on("active",k)):"paused"===a&&(n.pull.on("paused",j),n.push.on("paused",i))}),this.on("removeListener",function(a){"change"===a?(n.pull.removeListener("change",e),n.push.removeListener("change",f)):"denied"===a?(n.pull.removeListener("denied",h),n.push.removeListener("denied",g)):"active"===a?(n.pull.removeListener("active",l),n.push.removeListener("active",k)):"paused"===a&&(n.pull.removeListener("paused",j),n.push.removeListener("paused",i))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var r=fd.all([this.push,this.pull]).then(function(a){var b={push:a[0],pull:a[1]};return n.emit("complete",b),d&&d(null,b),n.removeAllListeners(),b},function(a){if(n.cancel(),d?d(a):n.emit("error",a),n.removeAllListeners(),d)throw a});this.then=function(a,b){return r.then(a,b)},this["catch"]=function(a){return r["catch"](a)}}function Ra(a,b){return qa(Td(a),b)}function Sa(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return b}function Ta(a,b){if("undefined"==typeof FileReader)return b(Sa((new FileReaderSync).readAsArrayBuffer(a)));var c=new FileReader,d="function"==typeof c.readAsBinaryString;c.onloadend=function(a){var c=a.target.result||"";return d?b(c):void b(Sa(c))},d?c.readAsBinaryString(a):c.readAsArrayBuffer(a)}function Ua(a){return new fd(function(b){Ta(a,function(a){b(Ud(a))})})}function Va(a){for(var b=[],c=0,d=a.length;d>c;c++)b=b.concat(a[c]);return b}function Wa(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];c.data=Ra(c.data,c.content_type)})}function Xa(a){return/^_design/.test(a)?"_design/"+encodeURIComponent(a.slice(8)):/^_local/.test(a)?"_local/"+encodeURIComponent(a.slice(7)):encodeURIComponent(a)}function Ya(a){return a._attachments&&Object.keys(a._attachments)?fd.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];return c.data&&"string"!=typeof c.data?Ua(c.data).then(function(a){c.data=a}):void 0})):fd.resolve()}function Za(a){var b=oa(a);(b.user||b.password)&&(b.auth={username:b.user,password:b.password});var c=b.path.replace(/(^\/|\/$)/g,"").split("/");return b.db=c.pop(),-1===b.db.indexOf("%")&&(b.db=encodeURIComponent(b.db)),b.path=c.join("/"),b}function $a(a,b){return _a(a,a.db+"/"+b)}function _a(a,b){var c=a.path?"/":"";return a.protocol+"://"+a.host+(a.port?":"+a.port:"")+"/"+a.path+c+b}function ab(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}function bb(a,b){function c(a,b,c){var d=a.ajax||{},e=Uc.extend(j(o),d,b);return le(e.method+" "+e.url),Wd.ajax(e,c)}function d(a,b){return new fd(function(d,e){c(a,b,function(a,b){return a?e(a):void d(b)})})}function e(a,b){return m(a,Zc(function(a){g().then(function(c){return b.apply(this,a)})["catch"](function(b){var c=a.pop();c(b)})}))}function g(){if(a.skipSetup||a.skip_setup)return fd.resolve();if(r)return r;var b={method:"GET",url:n};return r=d({},b)["catch"](function(a){return a&&a.status&&404===a.status?(ta(404,"PouchDB is just detecting if the remote exists."),d({},{method:"PUT",url:n})):fd.reject(a)})["catch"](function(a){return a&&a.status&&412===a.status?!0:fd.reject(a)}),r["catch"](function(){r=null}),r}function h(a){return a.split("/").map(encodeURIComponent).join("/")}var i=this,k=Za;a.getHost&&(k=a.getHost);var l=k(a.name,a),n=$a(l,"");a=j(a);var o=a.ajax||{};if(i.getUrl=function(){return n},i.getHeaders=function(){return o.headers||{}},a.auth||l.auth){var p=a.auth||l.auth,q=Ud(p.username+":"+p.password);o.headers=o.headers||{},o.headers.Authorization="Basic "+q}var r;setTimeout(function(){b(null,i)}),i.type=function(){return"http"},i.id=e("id",function(a){c({},{method:"GET",url:_a(l,"")},function(b,c){var d=c&&c.uuid?c.uuid+l.db:$a(l,"");a(null,d)})}),i.request=e("request",function(a,b){a.url=$a(l,a.url),c({},a,b)}),i.compact=e("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=j(a),c(a,{url:$a(l,"_compact"),method:"POST"},function(){function c(){i.info(function(d,e){e&&!e.compact_running?b(null,{ok:!0}):setTimeout(c,a.interval||200)})}c()})}),i.bulkGet=m("bulkGet",function(a,b){function d(b){var d={};a.revs&&(d.revs=!0),a.attachments&&(d.attachments=!0),c({},{url:$a(l,"_bulk_get"+ab(d)),method:"POST",body:{docs:a.docs}},b)}function e(){function c(a){return function(c,d){i[a]=d.results,++h===e&&b(null,{results:Va(i)})}}for(var d=ie,e=Math.ceil(a.docs.length/d),h=0,i=new Array(e),j=0;e>j;j++){var k=f(a,["revs","attachments"]);k.docs=a.docs.slice(j*d,Math.min(a.docs.length,(j+1)*d)),F(g,k,c(j))}}var g=this,h=_a(l,""),i=je[h];"boolean"!=typeof i?d(function(a,c){if(a){var d=Math.floor(a.status/100);4===d||5===d?(je[h]=!1,ta(a.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),e()):b(a)}else je[h]=!0,b(null,c)}):i?d(b):e()}),i._info=function(a){g().then(function(){c({},{method:"GET",url:$a(l,"")},function(b,c){return b?a(b):(c.host=$a(l,""),void a(null,c))})})["catch"](a)},i.get=e("get",function(a,b,c){function e(a){var c=a._attachments,e=c&&Object.keys(c);return c&&e.length?fd.all(e.map(function(e){var f=c[e],g=Xa(a._id)+"/"+h(e)+"?rev="+a._rev;return d(b,{method:"GET",url:$a(l,g),binary:!0}).then(function(a){return b.binary?a:Ua(a)}).then(function(a){delete f.stub,delete f.length,f.data=a})})):void 0}function f(a){return Array.isArray(a)?fd.all(a.map(function(a){return a.ok?e(a.ok):void 0})):e(a)}"function"==typeof b&&(c=b,b={}),b=j(b);var g={};b.revs&&(g.revs=!0),b.revs_info&&(g.revs_info=!0),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),g.open_revs=b.open_revs),b.rev&&(g.rev=b.rev),b.conflicts&&(g.conflicts=b.conflicts),a=Xa(a);var i={method:"GET",url:$a(l,a+ab(g))};d(b,i).then(function(a){return fd.resolve().then(function(){return b.attachments?f(a):void 0}).then(function(){c(null,a)})})["catch"](c)}),i.remove=e("remove",function(a,b,d,e){var f;"string"==typeof b?(f={_id:a,_rev:b},"function"==typeof d&&(e=d,d={})):(f=a,"function"==typeof b?(e=b,d={}):(e=d,d=b));var g=f._rev||d.rev;c(d,{method:"DELETE",url:$a(l,Xa(f._id))+"?rev="+g},e)}),i.getAttachment=e("getAttachment",function(a,b,d,e){"function"==typeof d&&(e=d,d={});var f=d.rev?"?rev="+d.rev:"",g=$a(l,Xa(a))+"/"+h(b)+f;c(d,{method:"GET",url:g,binary:!0},e)}),i.removeAttachment=e("removeAttachment",function(a,b,d,e){var f=$a(l,Xa(a)+"/"+h(b))+"?rev="+d;c({},{method:"DELETE",url:f},e)}),i.putAttachment=e("putAttachment",function(a,b,d,e,f,g){"function"==typeof f&&(g=f,f=e,e=d,d=null);var i=Xa(a)+"/"+h(b),j=$a(l,i);if(d&&(j+="?rev="+d),"string"==typeof e){var k;try{k=Td(e)}catch(m){return g(B(qd,"Attachment is not a valid base64 string"))}e=k?qa(k,f):""}var n={headers:{"Content-Type":f},method:"PUT",url:j,processData:!1,body:e,timeout:o.timeout||6e4};c({},n,g)}),i._bulkDocs=function(a,b,d){a.new_edits=b.new_edits,g().then(function(){return fd.all(a.docs.map(Ya))}).then(function(){c(b,{method:"POST",url:$a(l,"_bulk_docs"),body:a},function(a,b){return a?d(a):(b.forEach(function(a){a.ok=!0}),void d(null,b))})})["catch"](d)},i.allDocs=e("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=j(a);var c,e={},f="GET";a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),a.include_docs&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.key&&(e.key=JSON.stringify(a.key)),a.start_key&&(a.startkey=a.start_key),a.startkey&&(e.startkey=JSON.stringify(a.startkey)),a.end_key&&(a.endkey=a.end_key),a.endkey&&(e.endkey=JSON.stringify(a.endkey)),"undefined"!=typeof a.inclusive_end&&(e.inclusive_end=!!a.inclusive_end),"undefined"!=typeof a.limit&&(e.limit=a.limit),"undefined"!=typeof a.skip&&(e.skip=a.skip);var g=ab(e);if("undefined"!=typeof a.keys){var h="keys="+encodeURIComponent(JSON.stringify(a.keys));h.length+g.length+1<=ke?g+="&"+h:(f="POST",c={keys:a.keys})}d(a,{method:f,url:$a(l,"_all_docs"+g),body:c}).then(function(c){a.include_docs&&a.attachments&&a.binary&&c.rows.forEach(Wa),b(null,c)})["catch"](b)}),i._changes=function(a){var b="batch_size"in a?a.batch_size:he;a=j(a),a.timeout="timeout"in a?a.timeout:"timeout"in o?o.timeout:3e4;var d,e=a.timeout?{timeout:a.timeout-5e3}:{},f="undefined"!=typeof a.limit?a.limit:!1;d="return_docs"in a?a.return_docs:"returnDocs"in a?a.returnDocs:!0;var h=f;if(a.style&&(e.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(e.include_docs=!0),a.attachments&&(e.attachments=!0),a.continuous&&(e.feed="longpoll"),a.conflicts&&(e.conflicts=!0),a.descending&&(e.descending=!0),"heartbeat"in a?a.heartbeat&&(e.heartbeat=a.heartbeat):e.heartbeat=1e4,a.filter&&"string"==typeof a.filter&&(e.filter=a.filter,"_view"===a.filter&&a.view&&"string"==typeof a.view&&(e.view=a.view)),a.query_params&&"object"==typeof a.query_params)for(var i in a.query_params)a.query_params.hasOwnProperty(i)&&(e[i]=a.query_params[i]);
var k,m="GET";if(a.doc_ids){e.filter="_doc_ids";var n=JSON.stringify(a.doc_ids);n.length<ke?e.doc_ids=n:(m="POST",k={doc_ids:a.doc_ids})}var p,q,r=function(d,i){if(!a.aborted){e.since=d,"object"==typeof e.since&&(e.since=JSON.stringify(e.since)),a.descending?f&&(e.limit=h):e.limit=!f||h>b?b:h;var j={method:m,url:$a(l,"_changes"+ab(e)),timeout:a.timeout,body:k};q=d,a.aborted||g().then(function(){p=c(a,j,i)})["catch"](i)}},s={results:[]},t=function(c,e){if(!a.aborted){var g=0;if(e&&e.results){g=e.results.length,s.last_seq=e.last_seq;var i={};i.query=a.query_params,e.results=e.results.filter(function(b){h--;var c=sa(a)(b);return c&&(a.include_docs&&a.attachments&&a.binary&&Wa(b),d&&s.results.push(b),a.onChange(b)),c})}else if(c)return a.aborted=!0,void a.complete(c);e&&e.last_seq&&(q=e.last_seq);var j=f&&0>=h||e&&b>g||a.descending;(!a.continuous||f&&0>=h)&&j?a.complete(null,s):setTimeout(function(){r(q,t)},0)}};return r(a.since||0,t),{cancel:function(){a.aborted=!0,p&&p.abort()}}},i.revsDiff=e("revsDiff",function(a,b,d){"function"==typeof b&&(d=b,b={}),c(b,{method:"POST",url:$a(l,"_revs_diff"),body:a},d)}),i._close=function(a){a()},i._destroy=function(b,d){c(b,{url:$a(l,""),method:"DELETE"},function(b,c){return b&&b.status&&404!==b.status?d(b):(i.emit("destroyed"),i.constructor.emit("destroyed",a.name),void d(null,c))})}}function cb(){this.promise=new fd(function(a){a()})}function db(a){return dd.hash(a)}function eb(a){var b=a.db,c=a.viewName,d=a.map,e=a.reduce,f=a.temporary,g=d.toString()+(e&&e.toString())+"undefined";if(!f&&b._cachedViews){var h=b._cachedViews[g];if(h)return fd.resolve(h)}return b.info().then(function(a){function h(a){a.views=a.views||{};var b=c;-1===b.indexOf("/")&&(b=c+"/"+c);var d=a.views[b]=a.views[b]||{};return d[i]?void 0:(d[i]=!0,a)}var i=a.db_name+"-mrview-"+(f?"temp":db(g));return n(b,"_local/mrviews",h).then(function(){return b.registerDependentDatabase(i).then(function(a){var c=a.db;c.auto_compaction=!0;var h={name:i,db:c,sourceDB:b,adapter:b.adapter,mapFun:d,reduceFun:e};return h.db.get("_local/lastSeq")["catch"](function(a){if(404!==a.status)throw a}).then(function(a){return h.seq=a?a.seq:0,f||(b._cachedViews=b._cachedViews||{},b._cachedViews[g]=h,h.db.once("destroyed",function(){delete b._cachedViews[g]})),h})})})})}function fb(a,b,c,d,e,f){return cd("return ("+a.replace(/;\s*$/,"")+");",{emit:b,sum:c,log:d,isArray:e,toJSON:f})}function gb(a){return-1===a.indexOf("/")?[a,a]:a.split("/")}function hb(a){return 1===a.length&&/^1-/.test(a[0].rev)}function ib(a,b){try{a.emit("error",b)}catch(c){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(b)}}function jb(a,b,c){try{return{output:b.apply(null,c)}}catch(d){return ib(a,d),{error:d}}}function kb(a,b){var c=te(a.key,b.key);return 0!==c?c:te(a.value,b.value)}function lb(a,b,c){return c=c||0,"number"==typeof b?a.slice(c,b+c):c>0?a.slice(c):a}function mb(a){var b=a.value,c=b&&"object"==typeof b&&b._id||a.id;return c}function nb(a){a.rows.forEach(function(a){var b=a.doc&&a.doc._attachments;b&&Object.keys(b).forEach(function(a){var c=b[a];b[a].data=Ra(c.data,c.content_type)})})}function ob(a){return function(b){return a.include_docs&&a.attachments&&a.binary&&nb(b),b}}function pb(a){var b="builtin "+a+" function requires map values to be numbers or number arrays";return new Nb(b)}function qb(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];if("number"!=typeof e){if(!Array.isArray(e))throw pb("_sum");b="number"==typeof b?[b]:b;for(var f=0,g=e.length;g>f;f++){var h=e[f];if("number"!=typeof h)throw pb("_sum");"undefined"==typeof b[f]?b.push(h):b[f]+=h}}else"number"==typeof b?b+=e:b[0]+=e}return b}function rb(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function sb(a){if("undefined"!=typeof a){var b=Number(a);return isNaN(b)||b!==parseInt(a,10)?a:b}}function tb(a){return a.group_level=sb(a.group_level),a.limit=sb(a.limit),a.skip=sb(a.skip),a}function ub(a){if(a){if("number"!=typeof a)return new Lb('Invalid value for integer: "'+a+'"');if(0>a)return new Lb('Invalid value for positive integer: "'+a+'"')}}function vb(a,b){var c=a.descending?"endkey":"startkey",d=a.descending?"startkey":"endkey";if("undefined"!=typeof a[c]&&"undefined"!=typeof a[d]&&te(a[c],a[d])>0)throw new Lb("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(b.reduce&&a.reduce!==!1){if(a.include_docs)throw new Lb("{include_docs:true} is invalid for reduce");if(a.keys&&a.keys.length>1&&!a.group&&!a.group_level)throw new Lb("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(b){var c=ub(a[b]);if(c)throw c})}function wb(a,b,c){var d,e=[],f="GET";if(rb("reduce",c,e),rb("include_docs",c,e),rb("attachments",c,e),rb("limit",c,e),rb("descending",c,e),rb("group",c,e),rb("group_level",c,e),rb("skip",c,e),rb("stale",c,e),rb("conflicts",c,e),rb("startkey",c,e,!0),rb("start_key",c,e,!0),rb("endkey",c,e,!0),rb("end_key",c,e,!0),rb("inclusive_end",c,e),rb("key",c,e,!0),e=e.join("&"),e=""===e?"":"?"+e,"undefined"!=typeof c.keys){var g=2e3,h="keys="+encodeURIComponent(JSON.stringify(c.keys));h.length+e.length+1<=g?e+=("?"===e[0]?"&":"?")+h:(f="POST","string"==typeof b?d={keys:c.keys}:b.keys=c.keys)}if("string"==typeof b){var i=gb(b);return a.request({method:f,url:"_design/"+i[0]+"/_view/"+i[1]+e,body:d}).then(ob(c))}return d=d||{},Object.keys(b).forEach(function(a){Array.isArray(b[a])?d[a]=b[a]:d[a]=b[a].toString()}),a.request({method:"POST",url:"_temp_view"+e,body:d}).then(ob(c))}function xb(a,b,c){return new fd(function(d,e){a._query(b,c,function(a,b){return a?e(a):void d(b)})})}function yb(a){return new fd(function(b,c){a._viewCleanup(function(a,d){return a?c(a):void b(d)})})}function zb(a){return function(b){if(404===b.status)return a;throw b}}function Ab(a,b,c){function d(){return hb(k)?fd.resolve(h):b.db.get(g)["catch"](zb(h))}function e(a){return a.keys.length?b.db.allDocs({keys:a.keys,include_docs:!0}):fd.resolve({rows:[]})}function f(a,b){for(var c=[],d={},e=0,f=b.rows.length;f>e;e++){var g=b.rows[e],h=g.doc;if(h&&(c.push(h),d[h._id]=!0,h._deleted=!j[h._id],!h._deleted)){var i=j[h._id];"value"in i&&(h.value=i.value)}}var k=Object.keys(j);return k.forEach(function(a){if(!d[a]){var b={_id:a},e=j[a];"value"in e&&(b.value=e.value),c.push(b)}}),a.keys=ze(k.concat(a.keys)),c.push(a),c}var g="_local/doc_"+a,h={_id:g,keys:[]},i=c[a],j=i.indexableKeysToKeyValues,k=i.changes;return d().then(function(a){return e(a).then(function(b){return f(a,b)})})}function Bb(a,b,c){var d="_local/lastSeq";return a.db.get(d)["catch"](zb({_id:d,seq:0})).then(function(d){var e=Object.keys(b);return fd.all(e.map(function(c){return Ab(c,a,b)})).then(function(b){var e=Va(b);return d.seq=c,e.push(d),a.db.bulkDocs({docs:e})})})}function Cb(a){var b="string"==typeof a?a:a.name,c=Ce[b];return c||(c=Ce[b]=new cb),c}function Db(a){return ye(Cb(a),function(){return Eb(a)})()}function Eb(a){function b(a,b){var c={id:e._id,key:ve(a)};"undefined"!=typeof b&&null!==b&&(c.value=ve(b)),d.push(c)}function c(b,c){return function(){return Bb(a,b,c)}}var d,e,f;if("function"==typeof a.mapFun&&2===a.mapFun.length){var g=a.mapFun;f=function(a){return g(a,b)}}else f=fb(a.mapFun.toString(),b,qb,me,Array.isArray,JSON.parse);var h=a.seq||0,i=new cb;return new fd(function(b,g){function j(){i.finish().then(function(){a.seq=h,b()})}function k(){function b(a){g(a)}a.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:Ee}).on("complete",function(b){var g=b.results;if(!g.length)return j();for(var l={},m=0,n=g.length;n>m;m++){var o=g[m];if("_"!==o.doc._id[0]){d=[],e=o.doc,e._deleted||jb(a.sourceDB,f,[e]),d.sort(kb);for(var p,q={},r=0,s=d.length;s>r;r++){var t=d[r],u=[t.key,t.id];0===te(t.key,p)&&u.push(r);var v=ue(u);q[v]=t,p=t.key}l[o.doc._id]={indexableKeysToKeyValues:q,changes:o.changes}}h=o.seq}return i.add(c(l,h)),g.length<Ee?j():k()}).on("error",b)}k()})}function Fb(a,b,c){0===c.group_level&&delete c.group_level;var d,e=c.group||c.group_level;d=Fe[a.reduceFun]?Fe[a.reduceFun]:fb(a.reduceFun.toString(),null,qb,me,Array.isArray,JSON.parse);var f=[],g=c.group_level;b.forEach(function(a){var b=f[f.length-1],c=e?a.key:null;return e&&Array.isArray(c)&&"number"==typeof g&&(c=c.length>g?c.slice(0,g):c),b&&0===te(b.key[0][0],c)?(b.key.push([c,a.id]),void b.value.push(a.value)):void f.push({key:[[c,a.id]],value:[a.value]})});for(var h=0,i=f.length;i>h;h++){var j=f[h],k=jb(a.sourceDB,d,[j.key,j.value,!1]);if(k.error&&k.error instanceof Nb)throw k.error;j.value=k.error?null:k.output,j.key=j.key[0][0]}return{rows:lb(f,c.limit,c.skip)}}function Gb(a,b){return ye(Cb(a),function(){return Hb(a,b)})()}function Hb(a,b){function c(b){return b.include_docs=!0,a.db.allDocs(b).then(function(a){return e=a.total_rows,a.rows.map(function(a){if("value"in a.doc&&"object"==typeof a.doc.value&&null!==a.doc.value){var b=Object.keys(a.doc.value).sort(),c=["id","key","value"];if(!(c>b||b>c))return a.doc.value}var d=we(a.doc._id);return{key:d[0],id:d[1],value:"value"in a.doc?a.doc.value:null}})})}function d(c){var d;if(d=f?Fb(a,c,b):{total_rows:e,offset:g,rows:c},b.include_docs){var h=ze(c.map(mb));return a.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:b.conflicts,attachments:b.attachments,binary:b.binary}).then(function(a){var b={};return a.rows.forEach(function(a){a.doc&&(b["$"+a.id]=a.doc)}),c.forEach(function(a){var c=mb(a),d=b["$"+c];d&&(a.doc=d)}),d})}return d}var e,f=a.reduceFun&&b.reduce!==!1,g=b.skip||0;if("undefined"==typeof b.keys||b.keys.length||(b.limit=0,delete b.keys),"undefined"!=typeof b.keys){var h=b.keys,i=h.map(function(a){var b={startkey:ue([a]),endkey:ue([a,{}])};return c(b)});return fd.all(i).then(Va).then(d)}var j={descending:b.descending};if(b.start_key&&(b.startkey=b.start_key),b.end_key&&(b.endkey=b.end_key),"undefined"!=typeof b.startkey&&(j.startkey=ue(b.descending?[b.startkey,{}]:[b.startkey])),"undefined"!=typeof b.endkey){var k=b.inclusive_end!==!1;b.descending&&(k=!k),j.endkey=ue(k?[b.endkey,{}]:[b.endkey])}if("undefined"!=typeof b.key){var l=ue([b.key]),m=ue([b.key,{}]);j.descending?(j.endkey=l,j.startkey=m):(j.startkey=l,j.endkey=m)}return f||("number"==typeof b.limit&&(j.limit=b.limit),j.skip=g),c(j).then(d)}function Ib(a){return a.request({method:"POST",url:"_view_cleanup"})}function Jb(a){return a.get("_local/mrviews").then(function(b){var c={};Object.keys(b.views).forEach(function(a){var b=gb(a),d="_design/"+b[0],e=b[1];c[d]=c[d]||{},c[d][e]=!0});var d={keys:Object.keys(c),include_docs:!0};return a.allDocs(d).then(function(d){var e={};d.rows.forEach(function(a){var d=a.key.substring(8);Object.keys(c[a.key]).forEach(function(c){var f=d+"/"+c;b.views[f]||(f=c);var g=Object.keys(b.views[f]),h=a.doc&&a.doc.views&&a.doc.views[c];g.forEach(function(a){e[a]=e[a]||h})})});var f=Object.keys(e).filter(function(a){return!e[a]}),g=f.map(function(b){return ye(Cb(b),function(){return new a.constructor(b,a.__opts).destroy()})()});return fd.all(g).then(function(){return{ok:!0}})})},zb({ok:!0}))}function Kb(a,b,d){if("http"===a.type())return wb(a,b,d);if("function"==typeof a._query)return xb(a,b,d);if("string"!=typeof b){vb(d,b);var e={db:a,viewName:"temp_view/temp_view",map:b.map,reduce:b.reduce,temporary:!0};return De.add(function(){return eb(e).then(function(a){function b(){return a.db.destroy()}return Ae(Db(a).then(function(){return Gb(a,d)}),b)})}),De.finish()}var f=b,g=gb(f),h=g[0],i=g[1];return a.get("_design/"+h).then(function(b){var e=b.views&&b.views[i];if(!e||"string"!=typeof e.map)throw new Mb("ddoc "+h+" has no view named "+i);vb(d,e);var g={db:a,viewName:f,map:e.map,reduce:e.reduce};return eb(g).then(function(a){return"ok"===d.stale||"update_after"===d.stale?("update_after"===d.stale&&c.nextTick(function(){Db(a)}),Gb(a,d)):Db(a).then(function(){return Gb(a,d)})})})}function Lb(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Lb)}catch(b){}}function Mb(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Mb)}catch(b){}}function Nb(a){this.status=500,this.name="invalid_value",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Nb)}catch(b){}}function Ob(a,b,c){function d(a){try{return Td(a)}catch(b){var c=B(qd,"Attachment is not a valid base64 string");return{error:c}}}function e(a,c){if(a.stub)return c();if("string"==typeof a.data){var e=d(a.data);if(e.error)return c(e.error);a.length=e.length,"blob"===b?a.data=qa(e,a.content_type):"base64"===b?a.data=Ud(e):a.data=e,ee(e).then(function(b){a.digest="md5-"+b,c()})}else fa(a.data,function(d){"binary"===b?a.data=Sa(d):"base64"===b&&(a.data=Ud(Sa(d))),ee(d).then(function(b){a.digest="md5-"+b,a.length=d.byteLength,c()})})}function f(){h++,a.length===h&&(g?c(g):c())}if(!a.length)return c();var g,h=0;a.forEach(function(a){function b(a){g=a,d++,d===c.length&&f()}var c=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],d=0;if(!c.length)return f();for(var h in a.data._attachments)a.data._attachments.hasOwnProperty(h)&&e(a.data._attachments[h],b)})}function Pb(a,b){return a.pos-b.pos}function Qb(a,b,c){for(var d,e=0,f=a.length;f>e;)d=e+f>>>1,c(a[d],b)<0?e=d+1:f=d;return e}function Rb(a,b,c){var d=Qb(a,b,c);a.splice(d,0,b)}function Sb(a,b){for(var c,d,e=b,f=a.length;f>e;e++){var g=a[e],h=[g.id,g.opts,[]];d?(d[2].push(h),d=h):c=d=h}return c}function Tb(a,b){return a[0]<b[0]?-1:1}function Ub(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",Rb(f[2],g[2][h],Tb))}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function Vb(a,b,c){var d,e=[],f=!1,g=!1;if(!a.length)return{tree:[b],conflicts:"new_leaf"};for(var h=0,i=a.length;i>h;h++){var j=a[h];if(j.pos===b.pos&&j.ids[0]===b.ids[0])d=Ub(j.ids,b.ids),e.push({pos:j.pos,ids:d.tree}),f=f||d.conflicts,g=!0;else if(c!==!0){var k=j.pos<b.pos?j:b,l=j.pos<b.pos?b:j,m=l.pos-k.pos,n=[],o=[];for(o.push({ids:k.ids,diff:m,parent:null,parentIdx:null});o.length>0;){var p=o.pop();if(0!==p.diff)for(var q=p.ids[2],r=0,s=q.length;s>r;r++)o.push({ids:q[r],diff:p.diff-1,parent:p.ids,parentIdx:r});else p.ids[0]===l.ids[0]&&n.push(p)}var t=n[0];t?(d=Ub(t.ids,l.ids),t.parent[2][t.parentIdx]=d.tree,e.push({pos:k.pos,ids:k.ids}),f=f||d.conflicts,g=!0):e.push(j)}else e.push(j)}return g||e.push(b),e.sort(Pb),{tree:e,conflicts:f||"internal_node"}}function Wb(a,b){for(var c,d=H(a),e=0,f=d.length;f>e;e++){var g=d[e],h=g.ids,i=Math.max(0,h.length-b),j={pos:g.pos+i,ids:Sb(h,i)};c=c?Vb(c,j,!0).tree:[j]}return c}function Xb(a,b,c){var d=Vb(a,b);return{tree:Wb(d.tree,c),conflicts:d.conflicts}}function Yb(a,b){for(var c,d=a.slice(),e=b.split("-"),f=parseInt(e[0],10),g=e[1];c=d.pop();){if(c.pos===f&&c.ids[0]===g)return!0;for(var h=c.ids[2],i=0,j=h.length;j>i;i++)d.push({pos:c.pos+1,ids:h[i]})}return!1}function Zb(a,b,c,d,e,f,g,h){if(Yb(b.rev_tree,c.metadata.rev))return d[e]=c,f();var i=b.winningRev||p(b),j="deleted"in b?b.deleted:r(b,i),k="deleted"in c.metadata?c.metadata.deleted:r(c.metadata),l=/^1-/.test(c.metadata.rev);if(j&&!k&&h&&l){var m=c.data;m._rev=i,m._id=c.metadata.id,c=O(m,h)}var n=Xb(b.rev_tree,c.metadata.rev_tree[0],a),o=h&&(j&&k||!j&&"new_leaf"!==n.conflicts||j&&!k&&"new_branch"===n.conflicts);if(o){var q=B(kd);return d[e]=q,f()}var s=c.metadata.rev;c.metadata.rev_tree=n.tree,b.rev_map&&(c.metadata.rev_map=b.rev_map);var t,u=p(c.metadata),v=r(c.metadata,u),w=j===v?0:v>j?-1:1;t=s===u?v:r(c.metadata,s),g(c,u,v,t,!0,w,e,f)}function $b(a){return"missing"===a.metadata.rev_tree[0].ids[1].status}function _b(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=p(a.metadata),e=r(a.metadata,d);if("was_delete"in h&&e)return f[b]=B(jd,"deleted"),c();var i=l&&$b(a);if(i){var j=B(kd);return f[b]=j,c()}var k=e?0:1;g(a,d,e,e,!1,k,b,c)}function k(){++n===o&&i&&i()}a=a||1e3;var l=h.new_edits,m=new Xc.Map,n=0,o=b.length;b.forEach(function(a,b){if(a._id&&G(a._id)){var d=a._deleted?"_removeLocal":"_putLocal";return void c[d](a,{ctx:e},function(a,c){f[b]=a||c,k()})}var g=a.metadata.id;m.has(g)?(o--,m.get(g).push([a,b])):m.set(g,[[a,b]])}),m.forEach(function(b,c){function e(){++i<b.length?h():k()}function h(){var h=b[i],k=h[0],m=h[1];if(d.has(c))Zb(a,d.get(c),k,f,m,e,g,l);else{var n=Xb([],k.metadata.rev_tree[0],a);k.metadata.rev_tree=n.tree,j(k,m,e)}}var i=0;h()})}function ac(a){var b=[];return w(a.rev_tree,function(a,c,d,e,f){"available"!==f.status||a||(b.push(c+"-"+d),f.status="missing")}),b}function bc(a){try{return JSON.parse(a)}catch(b){return ed.parse(a)}}function cc(a){try{return JSON.stringify(a)}catch(b){return ed.stringify(a)}}function dc(a,b,c,d){try{a.apply(b,c)}catch(e){d.emit("error",e)}}function ec(a){if(!Re.running&&Re.queue.length){Re.running=!0;var b=Re.queue.shift();b.action(function(d,e){dc(b.callback,this,[d,e],a),Re.running=!1,c.nextTick(function(){ec(a)})})}}function fc(a){return function(b){var c="unknown_error";b.target&&b.target.error&&(c=b.target.error.name||b.target.error.message),a(B(xd,c,b.type))}}function gc(a,b,c){return{data:cc(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}}function hc(a){if(!a)return null;var b=bc(a.data);return b.winningRev=a.winningRev,b.deleted="1"===a.deletedOrLocal,b.seq=a.seq,b}function ic(a){if(!a)return a;var b=a._doc_id_rev.lastIndexOf(":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a}function jc(a,b,c,d){c?d(a?"string"!=typeof a?a:Ra(a,b):ea([""],{type:b})):a?"string"!=typeof a?Ta(a,function(a){d(Ud(a))}):d(a):d("")}function kc(a,b,c,d){function e(){++h===g.length&&d&&d()}function f(a,b){var d=a._attachments[b],f=d.digest,g=c.objectStore(Me).get(f);g.onsuccess=function(a){d.body=a.target.result.body,e()}}var g=Object.keys(a._attachments||{});if(!g.length)return d&&d();var h=0;g.forEach(function(c){b.attachments&&b.include_docs?f(a,c):(a._attachments[c].stub=!0,e())})}function lc(a,b){return fd.all(a.map(function(a){if(a.doc&&a.doc._attachments){var c=Object.keys(a.doc._attachments);return fd.all(c.map(function(c){var d=a.doc._attachments[c];if("body"in d){var e=d.body,g=d.content_type;return new fd(function(h){jc(e,g,b,function(b){a.doc._attachments[c]=Uc.extend(f(d,["digest","content_type"]),{data:b}),h()})})}}))}}))}function mc(a,b,c){function d(){j--,j||e()}function e(){f.length&&f.forEach(function(a){var b=i.index("digestSeq").count(IDBKeyRange.bound(a+"::",a+"::￿",!1,!1));b.onsuccess=function(b){var c=b.target.result;c||h["delete"](a)}})}var f=[],g=c.objectStore(Le),h=c.objectStore(Me),i=c.objectStore(Ne),j=a.length;a.forEach(function(a){var c=g.index("_doc_id_rev"),e=b+"::"+a;c.getKey(e).onsuccess=function(a){var b=a.target.result;if("number"!=typeof b)return d();g["delete"](b);var c=i.index("seq").openCursor(IDBKeyRange.only(b));c.onsuccess=function(a){var b=a.target.result;if(b){var c=b.value.digestSeq.split("::")[0];f.push(c),i["delete"](b.primaryKey),b["continue"]()}else d()}}})}function nc(a,b,c){try{return{txn:a.transaction(b,c)}}catch(d){return{error:d}}}function oc(a,b,c,d,e,f,g){function h(){var a=[Ke,Le,Me,Oe,Pe,Ne],b=nc(e,a,"readwrite");return b.error?g(b.error):(t=b.txn,t.onabort=fc(g),t.ontimeout=fc(g),t.oncomplete=k,u=t.objectStore(Ke),v=t.objectStore(Le),w=t.objectStore(Me),x=t.objectStore(Ne),void m(function(a){return a?(I=!0,g(a)):void j()}))}function i(){_b(a.revs_limit,z,d,H,t,F,n,c)}function j(){function a(){++c===z.length&&i()}function b(b){var c=hc(b.target.result);c&&H.set(c.id,c),a()}if(z.length)for(var c=0,d=0,e=z.length;e>d;d++){var f=z[d];if(f._id&&G(f._id))a();else{var g=u.get(f.metadata.id);g.onsuccess=b}}}function k(){I||(f.notify(d._meta.name),d._meta.docCount+=A,g(null,F))}function l(a,b){var c=w.get(a);c.onsuccess=function(c){if(c.target.result)b();else{var d=B(Dd,"unknown stub attachment with digest "+a);d.status=412,b(d)}}}function m(a){function b(){++e===c.length&&a(d)}var c=[];if(z.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){l(a,function(a){a&&!d&&(d=a),b()})})}function n(a,b,c,d,e,f,g,h){A+=f,a.metadata.winningRev=b,a.metadata.deleted=c;var i=a.data;i._id=a.metadata.id,i._rev=a.metadata.rev,d&&(i._deleted=!0);var j=i._attachments&&Object.keys(i._attachments).length;return j?q(a,b,c,e,g,h):void p(a,b,c,e,g,h)}function o(a){var b=ac(a.metadata);mc(b,a.metadata.id,t)}function p(a,b,c,e,f,g){function h(f){e&&d.auto_compaction&&o(a),l.seq=f.target.result,delete l.rev;var g=gc(l,b,c),h=u.put(g);h.onsuccess=j}function i(a){a.preventDefault(),a.stopPropagation();var b=v.index("_doc_id_rev"),c=b.getKey(k._doc_id_rev);c.onsuccess=function(a){var b=v.put(k,a.target.result);b.onsuccess=h}}function j(){F[f]={ok:!0,id:l.id,rev:b},H.set(a.metadata.id,a.metadata),r(a,l.seq,g)}var k=a.data,l=a.metadata;k._doc_id_rev=l.id+"::"+l.rev,delete k._id,delete k._rev;var m=v.put(k);m.onsuccess=h,m.onerror=i}function q(a,b,c,d,e,f){function g(){j===k.length&&p(a,b,c,d,e,f)}function h(){j++,g()}var i=a.data,j=0,k=Object.keys(i._attachments);k.forEach(function(b){var c=a.data._attachments[b];if(c.stub)j++,g();else{var d=c.data;delete c.data;var e=c.digest;s(e,d,h)}})}function r(a,b,c){function d(){++f===g.length&&c()}function e(c){var e=a.data._attachments[c].digest,f=x.put({seq:b,digestSeq:e+"::"+b});f.onsuccess=d,f.onerror=function(a){a.preventDefault(),a.stopPropagation(),d()}}var f=0,g=Object.keys(a.data._attachments||{});if(!g.length)return c();for(var h=0;h<g.length;h++)e(g[h])}function s(a,b,c){var d=w.count(a);d.onsuccess=function(d){var e=d.target.result;if(e)return c();var f={digest:a,body:b},g=w.put(f);g.onsuccess=c}}for(var t,u,v,w,x,y,z=b.docs,A=0,C=0,D=z.length;D>C;C++){var E=z[C];E._id&&G(E._id)||(E=z[C]=O(E,c.new_edits),E.error&&!y&&(y=E))}if(y)return g(y);var F=new Array(z.length),H=new Xc.Map,I=!1,J=d._meta.blobSupport?"blob":"base64";Ob(z,J,function(a){return a?g(a):void h()})}function pc(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}catch(f){return{error:f}}return null}function qc(a,b,c,d){return"DataError"===c.name&&0===c.code?d(null,{total_rows:a._meta.docCount,offset:b.skip,rows:[]}):void d(B(xd,c.name,c.message))}function rc(a,b,c,d){function e(a,d){function e(b,c,d){var e=b.id+"::"+d;x.get(e).onsuccess=function(d){c.doc=ic(d.target.result),a.conflicts&&(c.doc._conflicts=z(b)),kc(c.doc,a,t)}}function f(b,c,d){var f={id:d.id,key:d.id,value:{rev:c}},g=d.deleted;if("ok"===a.deleted)y.push(f),g?(f.value.deleted=!0,f.doc=null):a.include_docs&&e(d,f,c);else if(!g&&m--<=0&&(y.push(f),a.include_docs&&e(d,f,c),0===--n))return;b["continue"]()}function g(a){A=b._meta.docCount;var c=a.target.result;if(c){var d=hc(c.value),e=d.winningRev;f(c,e,d)}}function h(){d(null,{total_rows:A,offset:a.skip,rows:y})}function i(){a.attachments?lc(y,a.binary).then(h):h()}var j="startkey"in a?a.startkey:!1,k="endkey"in a?a.endkey:!1,l="key"in a?a.key:!1,m=a.skip||0,n="number"==typeof a.limit?a.limit:-1,o=a.inclusive_end!==!1,p="descending"in a&&a.descending?"prev":null,q=pc(j,k,o,l,p);if(q&&q.error)return qc(b,a,q.error,d);var r=[Ke,Le];a.attachments&&r.push(Me);var s=nc(c,r,"readonly");if(s.error)return d(s.error);var t=s.txn,u=t.objectStore(Ke),v=t.objectStore(Le),w=p?u.openCursor(q,p):u.openCursor(q),x=v.index("_doc_id_rev"),y=[],A=0;t.oncomplete=i,w.onsuccess=g}function f(a,c){return 0===a.limit?c(null,{total_rows:b._meta.docCount,offset:a.skip,rows:[]}):void e(a,c)}f(a,d)}function sc(a){return new fd(function(b){var c=ea([""]);a.objectStore(Qe).put(c,"key"),a.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)},a.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)}})["catch"](function(){return!1})}function tc(a){ba()?chrome.storage.onChanged.addListener(function(b){null!=b.db_name&&a.emit(b.dbName.newValue)}):ca()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(b){a.emit(b.key)}):window.attachEvent("storage",function(b){a.emit(b.key)}))}function uc(){Yc.EventEmitter.call(this),this._listeners={},tc(this)}function vc(a,b){var c=this;Re.queue.push({action:function(b){wc(c,a,b)},callback:b}),ec(c.constructor)}function wc(a,b,d){function e(a){var b=a.createObjectStore(Ke,{keyPath:"id"});a.createObjectStore(Le,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(Me,{keyPath:"digest"}),a.createObjectStore(Oe,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(Qe),b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),a.createObjectStore(Pe,{keyPath:"_id"});var c=a.createObjectStore(Ne,{autoIncrement:!0});c.createIndex("seq","seq"),c.createIndex("digestSeq","digestSeq",{unique:!0})}function f(a,b){var c=a.objectStore(Ke);c.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),c.openCursor().onsuccess=function(a){var d=a.target.result;if(d){var e=d.value,f=r(e);e.deletedOrLocal=f?"1":"0",c.put(e),d["continue"]()}else b()}}function g(a){a.createObjectStore(Pe,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function h(a,b){var c=a.objectStore(Pe),d=a.objectStore(Ke),e=a.objectStore(Le),f=d.openCursor();f.onsuccess=function(a){var f=a.target.result;if(f){var g=f.value,h=g.id,i=G(h),j=p(g);if(i){var k=h+"::"+j,l=h+"::",m=h+"::~",n=e.index("_doc_id_rev"),o=IDBKeyRange.bound(l,m,!1,!1),q=n.openCursor(o);q.onsuccess=function(a){if(q=a.target.result){var b=q.value;b._doc_id_rev===k&&c.put(b),e["delete"](q.primaryKey),q["continue"]()}else d["delete"](f.primaryKey),f["continue"]()}}else f["continue"]()}else b&&b()}}function i(a){var b=a.createObjectStore(Ne,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}function k(a,b){var c=a.objectStore(Le),d=a.objectStore(Me),e=a.objectStore(Ne),f=d.count();f.onsuccess=function(a){var d=a.target.result;return d?void(c.openCursor().onsuccess=function(a){var c=a.target.result;if(!c)return b();for(var d=c.value,f=c.primaryKey,g=Object.keys(d._attachments||{}),h={},i=0;i<g.length;i++){var j=d._attachments[g[i]];h[j.digest]=!0}var k=Object.keys(h);for(i=0;i<k.length;i++){var l=k[i];e.put({seq:f,digestSeq:l+"::"+f})}c["continue"]()}):b()}}function m(a){function b(a){return a.data?hc(a):(a.deleted="1"===a.deletedOrLocal,a)}var c=a.objectStore(Le),d=a.objectStore(Ke),e=d.openCursor();e.onsuccess=function(a){function e(){var a=h.id+"::",b=h.id+"::￿",d=c.index("_doc_id_rev").openCursor(IDBKeyRange.bound(a,b)),e=0;d.onsuccess=function(a){var b=a.target.result;if(!b)return h.seq=e,f();var c=b.primaryKey;c>e&&(e=c),b["continue"]()}}function f(){var a=gc(h,h.winningRev,h.deleted),b=d.put(a);b.onsuccess=function(){g["continue"]()}}var g=a.target.result;if(g){var h=b(g.value);return h.winningRev=h.winningRev||p(h),h.seq?f():void e()}}}var n=b.name,o=null;a._meta=null,a.type=function(){return"idb"},a._id=l(function(b){b(null,a._meta.instanceId)}),a._bulkDocs=function(c,d,e){oc(b,c,d,a,o,vc.Changes,e)},a._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h){var i=nc(o,[Ke,Le,Me],"readonly");if(i.error)return c(i.error);h=i.txn}h.objectStore(Ke).get(a).onsuccess=function(a){if(f=hc(a.target.result),!f)return g=B(jd,"missing"),d();if(r(f)&&!b.rev)return g=B(jd,"deleted"),d();var c=h.objectStore(Le),i=b.rev||f.winningRev,j=f.id+"::"+i;c.index("_doc_id_rev").get(j).onsuccess=function(a){return e=a.target.result,e&&(e=ic(e)),e?void d():(g=B(jd,"missing"),d())}}},a._getAttachment=function(a,b,c){var d;if(b.ctx)d=b.ctx;else{var e=nc(o,[Ke,Le,Me],"readonly");if(e.error)return c(e.error);d=e.txn}var f=a.digest,g=a.content_type;d.objectStore(Me).get(f).onsuccess=function(a){var d=a.target.result.body;jc(d,g,b.binary,function(a){c(null,a)})}},a._info=function(b){if(null===o||!Te[n]){var c=new Error("db isn't open");return c.id="idbNull",b(c)}var d,e,f=nc(o,[Le],"readonly");if(f.error)return b(f.error);var g=f.txn,h=g.objectStore(Le).openCursor(null,"prev");h.onsuccess=function(b){var c=b.target.result;d=c?c.key:0,e=a._meta.docCount},g.oncomplete=function(){b(null,{doc_count:e,update_seq:d,idb_attachment_format:a._meta.blobSupport?"binary":"base64"})}},a._allDocs=function(b,c){rc(b,a,o,c)},a._changes=function(b){function c(a){function c(){return j.seq!==g?a["continue"]():(i=g,j.winningRev===f._rev?e(f):void d())}function d(){var a=f._id+"::"+j.winningRev,b=r.get(a);b.onsuccess=function(a){e(ic(a.target.result))}}function e(c){var d=b.processChange(c,j,b);d.seq=j.seq;var e=u(d);return"object"==typeof e?b.complete(e):(e&&(t++,l&&s.push(d),b.attachments&&b.include_docs?kc(c,b,m,function(){lc([d],b.binary).then(function(){b.onChange(d)})}):b.onChange(d)),void(t!==k&&a["continue"]()))}var f=ic(a.value),g=a.key;if(h&&!h.has(f._id))return a["continue"]();var j;return(j=v.get(f._id))?c():void(q.get(f._id).onsuccess=function(a){j=hc(a.target.result),v.set(f._id,j),c()})}function d(a){var b=a.target.result;b&&c(b)}function e(){var a=[Ke,Le];b.attachments&&a.push(Me);var c=nc(o,a,"readonly");if(c.error)return b.complete(c.error);m=c.txn,m.onabort=fc(b.complete),m.oncomplete=f,p=m.objectStore(Le),q=m.objectStore(Ke),r=p.index("_doc_id_rev");var e;e=b.descending?p.openCursor(null,"prev"):p.openCursor(IDBKeyRange.lowerBound(b.since,!0)),e.onsuccess=d}function f(){function a(){b.complete(null,{results:s,last_seq:i})}!b.continuous&&b.attachments?lc(s).then(a):a()}if(b=j(b),b.continuous){var g=n+":"+J();return vc.Changes.addListener(n,g,a,b),vc.Changes.notify(n),{cancel:function(){vc.Changes.removeListener(n,g)}}}var h=b.doc_ids&&new Xc.Set(b.doc_ids);b.since=b.since||0;var i=b.since,k="limit"in b?b.limit:-1;0===k&&(k=1);var l;l="return_docs"in b?b.return_docs:"returnDocs"in b?b.returnDocs:!0;var m,p,q,r,s=[],t=0,u=sa(b),v=new Xc.Map;e()},a._close=function(a){return null===o?a(B(od)):(o.close(),delete Te[n],o=null,void a())},a._getRevisionTree=function(a,b){var c=nc(o,[Ke],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(Ke).get(a);e.onsuccess=function(a){var c=hc(a.target.result);c?b(null,c.rev_tree):b(B(jd))}},a._doCompaction=function(a,b,c){var d=[Ke,Le,Me,Ne],e=nc(o,d,"readwrite");if(e.error)return c(e.error);var f=e.txn,g=f.objectStore(Ke);g.get(a).onsuccess=function(c){var d=hc(c.target.result);w(d.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")}),mc(b,a,f);var e=d.winningRev,g=d.deleted;f.objectStore(Ke).put(gc(d,e,g))},f.onabort=fc(c),f.oncomplete=function(){c()}},a._getLocal=function(a,b){var c=nc(o,[Pe],"readonly");if(c.error)return b(c.error);var d=c.txn,e=d.objectStore(Pe).get(a);e.onerror=fc(b),e.onsuccess=function(a){var c=a.target.result;c?(delete c._doc_id_rev,b(null,c)):b(B(jd))}},a._putLocal=function(a,b,c){"function"==typeof b&&(c=b,b={}),delete a._revisions;var d=a._rev,e=a._id;d?a._rev="0-"+(parseInt(d.split("-")[1],10)+1):a._rev="0-1";var f,g=b.ctx;if(!g){var h=nc(o,[Pe],"readwrite");if(h.error)return c(h.error);g=h.txn,g.onerror=fc(c),g.oncomplete=function(){f&&c(null,f)}}var i,j=g.objectStore(Pe);d?(i=j.get(e),i.onsuccess=function(e){var g=e.target.result;if(g&&g._rev===d){var h=j.put(a);h.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)}}else c(B(kd))}):(i=j.add(a),i.onerror=function(a){
c(B(kd)),a.preventDefault(),a.stopPropagation()},i.onsuccess=function(){f={ok:!0,id:a._id,rev:a._rev},b.ctx&&c(null,f)})},a._removeLocal=function(a,b,c){"function"==typeof b&&(c=b,b={});var d=b.ctx;if(!d){var e=nc(o,[Pe],"readwrite");if(e.error)return c(e.error);d=e.txn,d.oncomplete=function(){f&&c(null,f)}}var f,g=a._id,h=d.objectStore(Pe),i=h.get(g);i.onerror=fc(c),i.onsuccess=function(d){var e=d.target.result;e&&e._rev===a._rev?(h["delete"](g),f={ok:!0,id:g,rev:"0-0"},b.ctx&&c(null,f)):c(B(jd))}},a._destroy=function(a,b){vc.Changes.removeAllListeners(n),vc.openReqList[n]&&vc.openReqList[n].result&&(vc.openReqList[n].result.close(),delete Te[n]);var c=indexedDB.deleteDatabase(n);c.onsuccess=function(){vc.openReqList[n]&&(vc.openReqList[n]=null),ca()&&n in localStorage&&delete localStorage[n],b(null,{ok:!0})},c.onerror=fc(b)};var q=Te[n];if(q)return o=q.idb,a._meta=q.global,void c.nextTick(function(){d(null,a)});var s;s=b.storage?xc(n,b.storage):indexedDB.open(n,Je),"openReqList"in vc||(vc.openReqList={}),vc.openReqList[n]=s,s.onupgradeneeded=function(a){function b(){var a=j[l-1];l++,a&&a(d,b)}var c=a.target.result;if(a.oldVersion<1)return e(c);var d=a.currentTarget.transaction;a.oldVersion<3&&g(c),a.oldVersion<4&&i(c);var j=[f,h,k,m],l=a.oldVersion;b()},s.onsuccess=function(b){o=b.target.result,o.onversionchange=function(){o.close(),delete Te[n]},o.onabort=function(a){console.error("Database has a global failure",a.target.error),o.close(),delete Te[n]};var c=o.transaction([Oe,Qe,Ke],"readwrite"),e=c.objectStore(Oe).get(Oe),f=null,g=null,h=null;e.onsuccess=function(b){var e=function(){null!==f&&null!==g&&null!==h&&(a._meta={name:n,instanceId:h,blobSupport:f,docCount:g},Te[n]={idb:o,global:a._meta},d(null,a))},i=b.target.result||{id:Oe};n+"_id"in i?(h=i[n+"_id"],e()):(h=J(),i[n+"_id"]=h,c.objectStore(Oe).put(i).onsuccess=function(){e()}),Se||(Se=sc(c)),Se.then(function(a){f=a,e()});var j=c.objectStore(Ke).index("deletedOrLocal");j.count(IDBKeyRange.only("0")).onsuccess=function(a){g=a.target.result,e()}}},s.onerror=function(a){var b="Failed to open indexedDB, are you in private browsing mode?";console.error(b),d(B(xd,b))}}function xc(a,b){try{return indexedDB.open(a,{version:Je,storage:b})}catch(c){return indexedDB.open(a,Je)}}function yc(a){return decodeURIComponent(window.escape(a))}function zc(a){return 65>a?a-48:a-55}function Ac(a,b,c){for(var d="";c>b;)d+=String.fromCharCode(zc(a.charCodeAt(b++))<<4|zc(a.charCodeAt(b++)));return d}function Bc(a,b,c){for(var d="";c>b;)d+=String.fromCharCode(zc(a.charCodeAt(b+2))<<12|zc(a.charCodeAt(b+3))<<8|zc(a.charCodeAt(b))<<4|zc(a.charCodeAt(b+1))),b+=4;return d}function Cc(a,b){return"UTF-8"===b?yc(Ac(a,0,a.length)):Bc(a,0,a.length)}function Dc(a){return"'"+a+"'"}function Ec(a){return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Fc(a){return a.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Gc(a){return delete a._id,delete a._rev,JSON.stringify(a)}function Hc(a,b,c){return a=JSON.parse(a),a._id=b,a._rev=c,a}function Ic(a){for(var b="(";a--;)b+="?",a&&(b+=",");return b+")"}function Jc(a,b,c,d,e){return"SELECT "+a+" FROM "+("string"==typeof b?b:b.join(" JOIN "))+(c?" ON "+c:"")+(d?" WHERE "+("string"==typeof d?d:d.join(" AND ")):"")+(e?" ORDER BY "+e:"")}function Kc(a,b,c){function d(){++f===a.length&&e()}function e(){if(g.length){var a="SELECT DISTINCT digest AS digest FROM "+$e+" WHERE seq IN "+Ic(g.length);c.executeSql(a,g,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d).digest);if(c.length){var e="DELETE FROM "+$e+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";a.executeSql(e,g,function(a){var b="SELECT digest FROM "+$e+" WHERE digest IN ("+c.map(function(){return"?"}).join(",")+")";a.executeSql(b,c,function(a,b){for(var d=new Xc.Set,e=0;e<b.rows.length;e++)d.add(b.rows.item(e).digest);c.forEach(function(b){d.has(b)||(a.executeSql("DELETE FROM "+$e+" WHERE digest=?",[b]),a.executeSql("DELETE FROM "+Xe+" WHERE digest=?",[b]))})})})}})}}if(a.length){var f=0,g=[];a.forEach(function(a){var e="SELECT seq FROM "+We+" WHERE doc_id=? AND rev=?";c.executeSql(e,[b,a],function(a,b){if(!b.rows.length)return d();var c=b.rows.item(0).seq;g.push(c),a.executeSql("DELETE FROM "+We+" WHERE seq=?",[c],d)})})}}function Lc(a){return function(b){console.error("WebSQL threw an error",b);var c=b&&b.constructor.toString().match(/function ([^\(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(B(yd,e,d))}}function Mc(a){if("size"in a)return 1e6*a.size;var b=/Android/.test(window.navigator.userAgent);return b?5e6:1}function Nc(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(a){return openDatabase(a.name,a.version,a.description,a.size)}:void 0}function Oc(a,b){try{return{db:a(b)}}catch(c){return{error:c}}}function Pc(a){var b=_e[a.name];if(!b){var c=Nc();b=_e[a.name]=Oc(c,a),b.db&&(b.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return b}function Qc(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function Rc(a,b,c,d,e,f,g){function h(){return t?g(t):(f.notify(d._name),d._docCount=-1,void g(null,u))}function i(a,b){var c="SELECT count(*) as cnt FROM "+Xe+" WHERE digest=?";s.executeSql(c,[a],function(c,d){if(0===d.rows.item(0).cnt){var e=B(Dd,"unknown stub attachment with digest "+a);b(e)}else b()})}function j(a){function b(){++e===c.length&&a(d)}var c=[];if(q.forEach(function(a){a.data&&a.data._attachments&&Object.keys(a.data._attachments).forEach(function(b){var d=a.data._attachments[b];d.stub&&c.push(d.digest)})}),!c.length)return a();var d,e=0;c.forEach(function(a){i(a,function(a){a&&!d&&(d=a),b()})})}function k(a,b,c,e,f,g,h,i){function j(){function b(a,b){function d(){return++f===g.length&&b(),!1}function e(b){var e="INSERT INTO "+$e+" (digest, seq) VALUES (?,?)",f=[c._attachments[b].digest,a];s.executeSql(e,f,d,d)}var f=0,g=Object.keys(c._attachments||{});if(!g.length)return b();for(var h=0;h<g.length;h++)e(g[h])}var c=a.data,d=e?1:0,f=c._id,g=c._rev,h=Gc(c),i="INSERT INTO "+We+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",j=[f,g,h,d];s.executeSql(i,j,function(a,c){var d=c.insertId;b(d,function(){o(a,d)})},function(){var a=Jc("seq",We,null,"doc_id=? AND rev=?");return s.executeSql(a,[f,g],function(a,c){var e=c.rows.item(0).seq,i="UPDATE "+We+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",j=[h,d,f,g];a.executeSql(i,j,function(a){b(e,function(){o(a,e)})})}),!1})}function k(a){p||(a?(p=a,i(p)):q===r.length&&j())}function l(a){q++,k(a)}function m(){if(f&&d.auto_compaction){var b=a.metadata.id,c=ac(a.metadata);Kc(c,b,s)}}function o(c,d){m(),a.metadata.seq=d,delete a.metadata.rev;var e=f?"UPDATE "+Ve+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+We+" WHERE doc_id="+Ve+".id AND rev=?) WHERE id=?":"INSERT INTO "+Ve+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",g=cc(a.metadata),j=a.metadata.id,k=f?[g,d,b,j]:[j,d,d,g];c.executeSql(e,k,function(){u[h]={ok:!0,id:a.metadata.id,rev:b},v.set(j,a.metadata),i()})}var p=null,q=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev;var r=Object.keys(a.data._attachments||{});e&&(a.data._deleted=!0),r.forEach(function(b){var c=a.data._attachments[b];if(c.stub)q++,k();else{var d=c.data;delete c.data;var e=c.digest;n(e,d,l)}}),r.length||j()}function l(){_b(a.revs_limit,q,d,v,s,u,k,c)}function m(a){function b(){++c===q.length&&a()}if(!q.length)return a();var c=0;q.forEach(function(a){if(a._id&&G(a._id))return b();var c=a.metadata.id;s.executeSql("SELECT json FROM "+Ve+" WHERE id = ?",[c],function(a,d){if(d.rows.length){var e=bc(d.rows.item(0).json);v.set(c,e)}b()})})}function n(a,b,c){var d="SELECT digest FROM "+Xe+" WHERE digest=?";s.executeSql(d,[a],function(e,f){return f.rows.length?c():(d="INSERT INTO "+Xe+" (digest, body, escaped) VALUES (?,?,1)",void e.executeSql(d,[a,Ec(b)],function(){c()},function(){return c(),!1}))})}var o=c.new_edits,p=b.docs,q=p.map(function(a){if(a._id&&G(a._id))return a;var b=O(a,o);return b}),r=q.filter(function(a){return a.error});if(r.length)return g(r[0]);var s,t,u=new Array(q.length),v=new Xc.Map;Ob(q,"binary",function(a){return a?g(a):void e.transaction(function(a){s=a,j(function(a){a?t=a:m(l)})},Lc(g),h)})}function Sc(a,b,c,d,e){function g(){++j===i.length&&e&&e()}function h(a,e){var h=a._attachments[e],i={binary:b.binary,ctx:d};c._getAttachment(h,i,function(b,c){a._attachments[e]=Uc.extend(f(h,["digest","content_type"]),{data:c}),g()})}var i=Object.keys(a._attachments||{});if(!i.length)return e&&e();var j=0;i.forEach(function(c){b.attachments&&b.include_docs?h(a,c):(a._attachments[c].stub=!0,g())})}function Tc(a,b){function c(){ca()&&(window.localStorage["_pouch__websqldb_"+t._name]=!0),b(null,t)}function d(a,b){a.executeSql(df),a.executeSql("ALTER TABLE "+We+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(bf),a.executeSql("ALTER TABLE "+Ve+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Ve+" (local, id)");var c="SELECT "+Ve+".winningseq AS seq, "+Ve+".json AS metadata FROM "+We+" JOIN "+Ve+" ON "+We+".seq = "+Ve+".winningseq";a.executeSql(c,[],function(a,c){for(var d=[],e=[],f=0;f<c.rows.length;f++){var g=c.rows.item(f),h=g.seq,i=JSON.parse(g.metadata);r(i)&&d.push(h),G(i.id)&&e.push(i.id)}a.executeSql("UPDATE "+Ve+"SET local = 1 WHERE id IN "+Ic(e.length),e,function(){a.executeSql("UPDATE "+We+" SET deleted = 1 WHERE seq IN "+Ic(d.length),d,b)})})})})}function e(a,b){var c="CREATE TABLE IF NOT EXISTS "+Ye+" (id UNIQUE, rev, json)";a.executeSql(c,[],function(){var c="SELECT "+Ve+".id AS id, "+We+".json AS data FROM "+We+" JOIN "+Ve+" ON "+We+".seq = "+Ve+".winningseq WHERE local = 1";a.executeSql(c,[],function(a,c){function d(){if(!e.length)return b(a);var c=e.shift(),f=JSON.parse(c.data)._rev;a.executeSql("INSERT INTO "+Ye+" (id, rev, json) VALUES (?,?,?)",[c.id,f,c.data],function(a){a.executeSql("DELETE FROM "+Ve+" WHERE id=?",[c.id],function(a){a.executeSql("DELETE FROM "+We+" WHERE seq=?",[c.seq],function(){d()})})})}for(var e=[],f=0;f<c.rows.length;f++)e.push(c.rows.item(f));d()})})}function f(a,b){function c(c){function d(){if(!c.length)return b(a);var e=c.shift(),f=Cc(e.hex,s),g=f.lastIndexOf("::"),h=f.substring(0,g),i=f.substring(g+2),j="UPDATE "+We+" SET doc_id=?, rev=? WHERE doc_id_rev=?";a.executeSql(j,[h,i,f],function(){d()})}d()}var d="ALTER TABLE "+We+" ADD COLUMN doc_id";a.executeSql(d,[],function(a){var b="ALTER TABLE "+We+" ADD COLUMN rev";a.executeSql(b,[],function(a){a.executeSql(cf,[],function(a){var b="SELECT hex(doc_id_rev) as hex FROM "+We;a.executeSql(b,[],function(a,b){for(var d=[],e=0;e<b.rows.length;e++)d.push(b.rows.item(e));c(d)})})})})}function g(a,b){function c(a){var c="SELECT COUNT(*) AS cnt FROM "+Xe;a.executeSql(c,[],function(a,c){function d(){var c=Jc(hf+", "+Ve+".id AS id",[Ve,We],gf,null,Ve+".id ");c+=" LIMIT "+g+" OFFSET "+f,f+=g,a.executeSql(c,[],function(a,c){function e(a,b){var c=f[a]=f[a]||[];-1===c.indexOf(b)&&c.push(b)}if(!c.rows.length)return b(a);for(var f={},g=0;g<c.rows.length;g++)for(var h=c.rows.item(g),i=Hc(h.data,h.id,h.rev),j=Object.keys(i._attachments||{}),k=0;k<j.length;k++){var l=i._attachments[j[k]];e(l.digest,h.seq)}var m=[];if(Object.keys(f).forEach(function(a){var b=f[a];b.forEach(function(b){m.push([a,b])})}),!m.length)return d();var n=0;m.forEach(function(b){var c="INSERT INTO "+$e+" (digest, seq) VALUES (?,?)";a.executeSql(c,b,function(){++n===m.length&&d()})})})}var e=c.rows.item(0).cnt;if(!e)return b(a);var f=0,g=10;d()})}var d="CREATE TABLE IF NOT EXISTS "+$e+" (digest, seq INTEGER)";a.executeSql(d,[],function(a){a.executeSql(ff,[],function(a){a.executeSql(ef,[],c)})})}function h(a,b){var c="ALTER TABLE "+Xe+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";a.executeSql(c,[],b)}function i(a,b){var c="ALTER TABLE "+Ve+" ADD COLUMN max_seq INTEGER";a.executeSql(c,[],function(a){var c="UPDATE "+Ve+" SET max_seq=(SELECT MAX(seq) FROM "+We+" WHERE doc_id=id)";a.executeSql(c,[],function(a){var c="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Ve+" (max_seq)";a.executeSql(c,[],b)})})}function k(a,b){a.executeSql('SELECT HEX("a") AS hex',[],function(a,c){var d=c.rows.item(0).hex;s=2===d.length?"UTF-8":"UTF-16",b()})}function m(){for(;x.length>0;){var a=x.pop();a(null,u)}}function n(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+Ze+" (dbid, db_version INTEGER)",j="CREATE TABLE IF NOT EXISTS "+Xe+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",k="CREATE TABLE IF NOT EXISTS "+$e+" (digest, seq INTEGER)",l="CREATE TABLE IF NOT EXISTS "+Ve+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",n="CREATE TABLE IF NOT EXISTS "+We+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",o="CREATE TABLE IF NOT EXISTS "+Ye+" (id UNIQUE, rev, json)";a.executeSql(j),a.executeSql(o),a.executeSql(k,[],function(){a.executeSql(ef),a.executeSql(ff)}),a.executeSql(l,[],function(){a.executeSql(df),a.executeSql(n,[],function(){a.executeSql(bf),a.executeSql(cf),a.executeSql(c,[],function(){var b="INSERT INTO "+Ze+" (db_version, dbid) VALUES (?,?)";u=J();var c=[Ue,u];a.executeSql(b,c,function(){m()})})})})}else{var p=function(){var c=Ue>b;c&&a.executeSql("UPDATE "+Ze+" SET db_version = "+Ue);var d="SELECT dbid FROM "+Ze;a.executeSql(d,[],function(a,b){u=b.rows.item(0).dbid,m()})},q=[d,e,f,g,h,i,p],r=b,s=function(a){q[r-1](a,s),r++};s(a)}}function o(){A.transaction(function(a){k(a,function(){p(a)})},Lc(b),c)}function p(a){var b="SELECT sql FROM sqlite_master WHERE tbl_name = "+Ze;a.executeSql(b,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+Ze,[],function(a,b){var c=b.rows.item(0).db_version;n(a,c)}):a.executeSql("ALTER TABLE "+Ze+" ADD COLUMN db_version INTEGER",[],function(){n(a,1)}):n(a,0)})}function q(a,b){if(-1!==t._docCount)return b(t._docCount);var c=Jc("COUNT("+Ve+".id) AS 'num'",[Ve,We],gf,We+".deleted=0");a.executeSql(c,[],function(a,c){t._docCount=c.rows.item(0).num,b(t._docCount)})}var s,t=this,u=null,v=Mc(a),x=[];t._docCount=-1,t._name=a.name;var y=Pc({name:t._name,version:af,description:t._name,size:v,location:a.location,createFromLocation:a.createFromLocation,androidDatabaseImplementation:a.androidDatabaseImplementation});if(y.error)return Lc(b)(y.error);var A=y.db;"function"!=typeof A.readTransaction&&(A.readTransaction=A.transaction),o(),t.type=function(){return"websql"},t._id=l(function(a){a(null,u)}),t._info=function(a){A.readTransaction(function(b){q(b,function(c){var d="SELECT MAX(seq) AS seq FROM "+We;b.executeSql(d,[],function(b,d){var e=d.rows.item(0).seq||0;a(null,{doc_count:c,update_seq:e,sqlite_plugin:A._sqlitePlugin,websql_encoding:s})})})},Lc(a))},t._bulkDocs=function(b,c,d){Rc(a,b,c,t,A,Tc.Changes,d)},t._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}var e,f,g,h=b.ctx;if(!h)return A.readTransaction(function(d){t._get(a,Uc.extend({ctx:d},b),c)});var i,j;b.rev?(i=Jc(hf,[Ve,We],Ve+".id="+We+".doc_id",[We+".doc_id=?",We+".rev=?"]),j=[a,b.rev]):(i=Jc(hf,[Ve,We],gf,Ve+".id=?"),j=[a]),h.executeSql(i,j,function(a,c){if(!c.rows.length)return g=B(jd,"missing"),d();var h=c.rows.item(0);return f=bc(h.metadata),h.deleted&&!b.rev?(g=B(jd,"deleted"),d()):(e=Hc(h.data,f.id,h.rev),void d())})},t._allDocs=function(a,b){var c,d=[],e="startkey"in a?a.startkey:!1,f="endkey"in a?a.endkey:!1,g="key"in a?a.key:!1,h="descending"in a?a.descending:!1,i="limit"in a?a.limit:-1,j="skip"in a?a.skip:0,k=a.inclusive_end!==!1,l=[],m=[];if(g!==!1)m.push(Ve+".id = ?"),l.push(g);else if(e!==!1||f!==!1){if(e!==!1&&(m.push(Ve+".id "+(h?"<=":">=")+" ?"),l.push(e)),f!==!1){var n=h?">":"<";k&&(n+="="),m.push(Ve+".id "+n+" ?"),l.push(f)}g!==!1&&(m.push(Ve+".id = ?"),l.push(g))}"ok"!==a.deleted&&m.push(We+".deleted = 0"),A.readTransaction(function(b){q(b,function(e){if(c=e,0!==i){var f=Jc(hf,[Ve,We],gf,m,Ve+".id "+(h?"DESC":"ASC"));f+=" LIMIT "+i+" OFFSET "+j,b.executeSql(f,l,function(b,c){for(var e=0,f=c.rows.length;f>e;e++){var g=c.rows.item(e),h=bc(g.metadata),i=h.id,j=Hc(g.data,i,g.rev),k=j._rev,l={id:i,key:i,value:{rev:k}};if(a.include_docs&&(l.doc=j,l.doc._rev=k,a.conflicts&&(l.doc._conflicts=z(h)),Sc(l.doc,a,t,b)),g.deleted){if("ok"!==a.deleted)continue;l.value.deleted=!0,l.doc=null}d.push(l)}})}})},Lc(b),function(){b(null,{total_rows:c,offset:a.skip,rows:d})})},t._changes=function(a){function b(){var b=Ve+".json AS metadata, "+Ve+".max_seq AS maxSeq, "+We+".json AS winningDoc, "+We+".rev AS winningRev ",c=Ve+" JOIN "+We,i=Ve+".id="+We+".doc_id AND "+Ve+".winningseq="+We+".seq",j=["maxSeq > ?"],k=[a.since];a.doc_ids&&(j.push(Ve+".id IN "+Ic(a.doc_ids.length)),k=k.concat(a.doc_ids));var l="maxSeq "+(d?"DESC":"ASC"),m=Jc(b,c,i,j,l),n=sa(a);a.view||a.filter||(m+=" LIMIT "+e);var o=a.since||0;A.readTransaction(function(b){b.executeSql(m,k,function(b,c){function d(b){return function(){a.onChange(b)}}for(var i=0,j=c.rows.length;j>i;i++){var k=c.rows.item(i),l=bc(k.metadata);o=k.maxSeq;var m=Hc(k.winningDoc,l.id,k.winningRev),p=a.processChange(m,l,a);p.seq=k.maxSeq;var q=n(p);if("object"==typeof q)return a.complete(q);if(q&&(h++,f&&g.push(p),a.attachments&&a.include_docs?Sc(m,a,t,b,d(p)):d(p)()),h===e)break}})},Lc(a.complete),function(){a.continuous||a.complete(null,{results:g,last_seq:o})})}if(a=j(a),a.continuous){var c=t._name+":"+J();return Tc.Changes.addListener(t._name,c,t,a),Tc.Changes.notify(t._name),{cancel:function(){Tc.Changes.removeListener(t._name,c)}}}var d=a.descending;a.since=a.since&&!d?a.since:0;var e="limit"in a?a.limit:-1;0===e&&(e=1);var f;f="return_docs"in a?a.return_docs:"returnDocs"in a?a.returnDocs:!0;var g=[],h=0;b()},t._close=function(a){a()},t._getAttachment=function(a,b,c){var d,e=b.ctx,f=a.digest,g=a.content_type,h="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Xe+" WHERE digest=?";e.executeSql(h,[f],function(a,e){var f=e.rows.item(0),h=f.escaped?Fc(f.body):Cc(f.body,s);d=b.binary?qa(h,g):Ud(h),c(null,d)})},t._getRevisionTree=function(a,b){A.readTransaction(function(c){var d="SELECT json AS metadata FROM "+Ve+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=bc(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(B(jd))})})},t._doCompaction=function(a,b,c){return b.length?void A.transaction(function(c){var d="SELECT json AS metadata FROM "+Ve+" WHERE id = ?";c.executeSql(d,[a],function(c,d){var e=bc(d.rows.item(0).metadata);w(e.rev_tree,function(a,c,d,e,f){var g=c+"-"+d;-1!==b.indexOf(g)&&(f.status="missing")});var f="UPDATE "+Ve+" SET json = ? WHERE id = ?";c.executeSql(f,[cc(e),a])}),Kc(b,a,c)},Lc(c),function(){c()}):c()},t._getLocal=function(a,b){A.readTransaction(function(c){var d="SELECT json, rev FROM "+Ye+" WHERE id=?";c.executeSql(d,[a],function(c,d){if(d.rows.length){var e=d.rows.item(0),f=Hc(e.json,a,e.rev);b(null,f)}else b(B(jd))})})},t._putLocal=function(a,b,c){function d(a){var d,j;f?(d="UPDATE "+Ye+" SET rev=?, json=? WHERE id=? AND rev=?",j=[e,i,g,f]):(d="INSERT INTO "+Ye+" (id, rev, json) VALUES (?,?,?)",j=[g,e,i]),a.executeSql(d,j,function(a,d){d.rowsAffected?(h={ok:!0,id:g,rev:e},b.ctx&&c(null,h)):c(B(kd))},function(){return c(B(kd)),!1})}"function"==typeof b&&(c=b,b={}),delete a._revisions;var e,f=a._rev,g=a._id;e=f?a._rev="0-"+(parseInt(f.split("-")[1],10)+1):a._rev="0-1";var h,i=Gc(a);b.ctx?d(b.ctx):A.transaction(d,Lc(c),function(){h&&c(null,h)})},t._removeLocal=function(a,b,c){function d(d){var f="DELETE FROM "+Ye+" WHERE id=? AND rev=?",g=[a._id,a._rev];d.executeSql(f,g,function(d,f){return f.rowsAffected?(e={ok:!0,id:a._id,rev:"0-0"},void(b.ctx&&c(null,e))):c(B(jd))})}"function"==typeof b&&(c=b,b={});var e;b.ctx?d(b.ctx):A.transaction(d,Lc(c),function(){e&&c(null,e)})},t._destroy=function(a,b){Tc.Changes.removeAllListeners(t._name),A.transaction(function(a){var b=[Ve,We,Xe,Ze,Ye,$e];b.forEach(function(b){a.executeSql("DROP TABLE IF EXISTS "+b,[])})},Lc(b),function(){ca()&&(delete window.localStorage["_pouch__websqldb_"+t._name],delete window.localStorage[t._name]),b(null,{ok:!0})})}}var Uc=a(7),Vc=e(Uc),Wc=e(a(6)),Xc=e(a(12)),Yc=a(4),Zc=e(a(1)),$c=e(a(2)),_c=a(10),ad=e(_c),bd=e(a(8)),cd=e(a(14)),dd=e(a(15)),ed=e(a(16)),fd="function"==typeof Promise?Promise:bd,gd=$c("pouchdb:api");Wc(A,Error),A.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var hd=new A({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),id=new A({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),jd=new A({status:404,error:"not_found",reason:"missing"}),kd=new A({status:409,error:"conflict",reason:"Document update conflict"}),ld=new A({status:400,error:"invalid_id",reason:"_id field must contain a string"}),md=new A({status:412,error:"missing_id",reason:"_id is required for puts"}),nd=new A({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),od=new A({status:412,error:"precondition_failed",reason:"Database not open"}),pd=new A({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),qd=new A({status:500,error:"badarg",reason:"Some query argument is invalid"}),rd=new A({status:400,error:"invalid_request",reason:"Request was invalid"}),sd=new A({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),td=new A({status:500,error:"doc_validation",reason:"Bad special document member"}),ud=new A({status:400,error:"bad_request",reason:"Something wrong with the request"}),vd=new A({status:400,error:"bad_request",reason:"Document must be a JSON object"}),wd=new A({status:404,error:"not_found",reason:"Database not found"}),xd=new A({status:500,error:"indexed_db_went_bad",reason:"unknown"}),yd=new A({status:500,error:"web_sql_went_bad",reason:"unknown"}),zd=new A({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),Ad=new A({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),Bd=new A({status:400,error:"bad_request",reason:"Invalid rev format"}),Cd=new A({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),Dd=new A({status:412,error:"missing_stub"}),Ed=new A({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),Fd={UNAUTHORIZED:hd,MISSING_BULK_DOCS:id,MISSING_DOC:jd,REV_CONFLICT:kd,INVALID_ID:ld,MISSING_ID:md,RESERVED_ID:nd,NOT_OPEN:od,UNKNOWN_ERROR:pd,BAD_ARG:qd,INVALID_REQUEST:rd,QUERY_PARSE_ERROR:sd,DOC_VALIDATION:td,BAD_REQUEST:ud,NOT_AN_OBJECT:vd,DB_MISSING:wd,WSQ_ERROR:yd,LDB_ERROR:zd,FORBIDDEN:Ad,INVALID_REV:Bd,FILE_EXISTS:Cd,MISSING_STUB:Dd,IDB_ERROR:xd,INVALID_URL:Ed},Gd=function(a,b,c){var d=Object.keys(Fd).filter(function(c){var d=Fd[c];return"function"!=typeof d&&d[a]===b}),e=c&&d.filter(function(a){var b=Fd[a];return b.message===c})[0]||d[0];return e?Fd[e]:null};Wc(D,Yc.EventEmitter),D.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},D.prototype.doChanges=function(a){var b=this,c=a.complete;if(a=j(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=E,"latest"===a.since&&(a.since="now"),a.since||(a.since=0),"now"===a.since)return void this.db.info().then(function(d){return b.isCancelled?void c(null,{status:"cancelled"}):(a.since=d.update_seq,void b.doChanges(a))},c);if(a.continuous&&"now"!==a.since&&this.db.info().then(function(a){b.startSeq=a.update_seq},function(a){if("idbNull"!==a.id)throw a}),a.filter&&"string"==typeof a.filter&&("_view"===a.filter?a.view=v(a.view):a.filter=v(a.filter),"http"!==this.db.type()&&!a.doc_ids))return this.filterChanges(a);"descending"in a||(a.descending=!1),a.limit=0===a.limit?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&"function"==typeof d.cancel){var e=b.cancel;b.cancel=Zc(function(a){d.cancel(),e.apply(this,a)})}},D.prototype.filterChanges=function(a){var b=this,c=a.complete;if("_view"===a.filter){if(!a.view||"string"!=typeof a.view){var d=B(ud,"`view` filter parameter not found or invalid.");return c(d)}var e=u(a.view);this.db.get("_design/"+e[0],function(d,f){if(b.isCancelled)return c(null,{status:"cancelled"});if(d)return c(C(d));var g=f&&f.views&&f.views[e[1]]&&f.views[e[1]].map;return g?(a.filter=t(g),void b.doChanges(a)):c(B(jd,f.views?"missing json key: "+e[1]:"missing json key: views"))})}else{var f=u(a.filter);if(!f)return b.doChanges(a);this.db.get("_design/"+f[0],function(d,e){if(b.isCancelled)return c(null,{status:"cancelled"});if(d)return c(C(d));var g=e&&e.filters&&e.filters[f[1]];return g?(a.filter=s(g),void b.doChanges(a)):c(B(jd,e&&e.filters?"missing json key: "+f[1]:"missing json key: filters"))})}};var Hd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Id=K(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Jd=K(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);Wc(Y,Yc.EventEmitter),Y.prototype.post=m("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(B(vd)):void this.bulkDocs({docs:[a]},b,R(c))}),Y.prototype.put=m("put",Zc(function(a){var b,c,d,e,f=a.shift(),g="_id"in f;if("object"!=typeof f||Array.isArray(f))return(e=a.pop())(B(vd));for(;b=a.shift(),c=typeof b,"string"!==c||g?"string"!==c||!g||"_rev"in f?"object"===c?d=b:"function"===c&&(e=b):f._rev=b:(f._id=b,g=!0),a.length;);return d=d||{},L(f._id),G(f._id)&&"function"==typeof this._putLocal?f._deleted?this._removeLocal(f,e):this._putLocal(f,e):void this.bulkDocs({docs:[f]},d,R(e))})),Y.prototype.putAttachment=m("putAttachment",function(a,b,c,d,e,f){function g(a){return a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d},h.put(a)}var h=this;return"function"==typeof e&&(f=e,e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),h.get(a).then(function(a){if(a._rev!==c)throw B(kd);return g(a)},function(b){if(b.reason===jd.message)return g({_id:a});throw b})}),Y.prototype.removeAttachment=m("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?void d(a):f._rev!==c?void d(B(kd)):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,void e.put(f,d)):d()})}),Y.prototype.remove=m("remove",function(a,b,c,d){var e;"string"==typeof b?(e={_id:a,_rev:b},"function"==typeof c&&(d=c,c={})):(e=a,"function"==typeof b?(d=b,c={}):(d=c,c=b)),c=c||{},c.was_delete=!0;var f={_id:e._id,_rev:e._rev||c.rev};return f._deleted=!0,G(f._id)&&"function"==typeof this._removeLocal?this._removeLocal(e,d):void this.bulkDocs({docs:[f]},c,R(d))}),Y.prototype.revsDiff=m("revsDiff",function(a,b,c){function d(a,b){h.has(a)||h.set(a,{missing:[]}),h.get(a).missing.push(b)}function e(b,c){var e=a[b].slice(0);w(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);-1!==j&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={});var f=Object.keys(a);if(!f.length)return c(null,{});var g=0,h=new Xc.Map;f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&404===d.status&&"missing"===d.message)h.set(b,{missing:a[b]});else{if(d)return c(d);e(b,i)}if(++g===f.length){var j={};return h.forEach(function(a,b){j[b]=a}),c(null,j)}})},this)}),Y.prototype.bulkGet=m("bulkGet",function(a,b){F(this,a,b)}),Y.prototype.compactDocument=m("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=U(f),h=[],i=[];Object.keys(g).forEach(function(a){g[a]>b&&h.push(a)}),w(f,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&-1!==h.indexOf(f)&&i.push(f)}),d._doCompaction(a,i,c)})}),Y.prototype.compact=m("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;a=a||{},c._compactionQueue=c._compactionQueue||[],c._compactionQueue.push({opts:a,callback:b}),1===c._compactionQueue.length&&W(c)}),Y.prototype._compact=function(a,b){function c(a){g.push(e.compactDocument(a.id,0))}function d(a){var c=a.last_seq;fd.all(g).then(function(){return n(e,"_local/compaction",function(a){return!a.last_seq||a.last_seq<c?(a.last_seq=c,a):!1})}).then(function(){b(null,{ok:!0})})["catch"](b)}var e=this,f={return_docs:!1,last_seq:a.last_seq||0},g=[];e.changes(f).on("change",c).on("complete",d).on("error",b)},Y.prototype.get=m("get",function(a,b,c){function d(){var d=[],g=e.length;return g?void e.forEach(function(e){f.get(a,{rev:e,revs:b.revs,attachments:b.attachments},function(a,b){a?d.push({missing:e}):d.push({ok:b}),g--,g||c(null,d)})}):c(null,d)}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(B(ld));if(G(a)&&"function"==typeof this._getLocal)return this._getLocal(a,c);var e=[],f=this;if(!b.open_revs)return this._get(a,b,function(a,d){if(a)return c(a);var e=d.doc,g=d.metadata,h=d.ctx;if(b.conflicts){var i=z(g);i.length&&(e._conflicts=i)}if(r(g,e._rev)&&(e._deleted=!0),b.revs||b.revs_info){var j=H(g.rev_tree),k=Q(j,function(a){return-1!==a.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])}),l=k.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])+1,m=k.ids.length-l;if(k.ids.splice(l,m),k.ids.reverse(),b.revs&&(e._revisions={start:k.pos+k.ids.length-1,ids:k.ids.map(function(a){return a.id})}),b.revs_info){var n=k.pos+k.ids.length;e._revs_info=k.ids.map(function(a){return n--,{rev:n+"-"+a.id,status:a.opts.status}})}}if(b.attachments&&e._attachments){var o=e._attachments,p=Object.keys(o).length;if(0===p)return c(null,e);Object.keys(o).forEach(function(a){this._getAttachment(o[a],{binary:b.binary,ctx:h},function(b,d){var f=e._attachments[a];f.data=d,delete f.stub,delete f.length,--p||c(null,e)})},f)}else{if(e._attachments)for(var q in e._attachments)e._attachments.hasOwnProperty(q)&&(e._attachments[q].stub=!0);c(null,e)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){return a?c(a):(e=y(b).map(function(a){return a.rev}),void d())});else{if(!Array.isArray(b.open_revs))return c(B(pd,"function_clause"));e=b.open_revs;for(var g=0;g<e.length;g++){var h=e[g];if("string"!=typeof h||!/^\d+-/.test(h))return c(B(Bd))}d()}}),Y.prototype.getAttachment=m("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),this._get(a,c,function(a,f){return a?d(a):f.doc._attachments&&f.doc._attachments[b]?(c.ctx=f.ctx,c.binary=!0,void e._getAttachment(f.doc._attachments[b],c,d)):d(B(jd))})}),Y.prototype.allDocs=m("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a.skip="undefined"!=typeof a.skip?a.skip:0,a.start_key&&(a.startkey=a.start_key),a.end_key&&(a.endkey=a.end_key),"keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return void b(B(sd,"Query parameter `"+c+"` is not compatible with multi-get"));if("http"!==this.type())return V(this,a,b)}return this._allDocs(a,b)}),Y.prototype.changes=function(a,b){return"function"==typeof a&&(b=a,a={}),new D(this,a,b)},Y.prototype.close=m("close",function(a){return this._closed=!0,this._close(a)}),Y.prototype.info=m("info",function(a){var b=this;this._info(function(c,d){return c?a(c):(d.db_name=d.db_name||b._db_name,d.auto_compaction=!(!b.auto_compaction||"http"===b.type()),d.adapter=b.type(),void a(null,d))})}),Y.prototype.id=m("id",function(a){return this._id(a)}),Y.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Y.prototype.bulkDocs=m("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=b||{},Array.isArray(a)&&(a={docs:a}),!a||!a.docs||!Array.isArray(a.docs))return c(B(id));for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(B(vd));
var e;return a.docs.forEach(function(a){a._attachments&&Object.keys(a._attachments).forEach(function(a){e=e||X(a)})}),e?c(B(ud,e)):("new_edits"in b||("new_edits"in a?b.new_edits=a.new_edits:b.new_edits=!0),b.new_edits||"http"===this.type()||a.docs.sort(T),S(a.docs),this._bulkDocs(a,b,function(a,d){return a?c(a):(b.new_edits||(d=d.filter(function(a){return a.error})),void c(null,d))}))}),Y.prototype.registerDependentDatabase=m("registerDependentDatabase",function(a,b){function c(b){return b.dependentDbs=b.dependentDbs||{},b.dependentDbs[a]?!1:(b.dependentDbs[a]=!0,b)}var d=new this.constructor(a,this.__opts);n(this,"_local/_pouch_dependentDbs",c).then(function(){b(null,{db:d})})["catch"](b)}),Y.prototype.destroy=m("destroy",function(a,b){function c(){d._destroy(a,function(a,c){return a?b(a):(d.emit("destroyed"),void b(null,c||{ok:!0}))})}"function"==typeof a&&(b=a,a={});var d=this,e="use_prefix"in d?d.use_prefix:!0;return"http"===d.type()?c():void d.get("_local/_pouch_dependentDbs",function(a,f){if(a)return 404!==a.status?b(a):c();var g=f.dependentDbs,h=d.constructor,i=Object.keys(g).map(function(a){var b=e?a.replace(new RegExp("^"+h.prefix),""):a;return new h(b,d.__opts).destroy()});fd.all(i).then(c,b)})}),Z.prototype.execute=function(){var a;if(this.failed)for(;a=this.queue.shift();)a(this.failed);else for(;a=this.queue.shift();)a()},Z.prototype.fail=function(a){this.failed=a,this.execute()},Z.prototype.ready=function(a){this.isReady=!0,this.db=a,this.execute()},Z.prototype.addTask=function(a){this.queue.push(a),this.failed&&this.execute()},Wc(aa,Y),aa.debug=$c;var Kd;if(ba())Kd=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Kd=!!localStorage.getItem("_pouch_check_localstorage")}catch(Ld){Kd=!1}aa.adapters={},aa.preferredAdapters=[],aa.prefix="_pouch_";var Md=new Yc.EventEmitter;da(aa),aa.parseAdapter=function(a,b){var c,d,e=a.match(/([a-z\-]*):\/\/(.*)/);if(e){if(a=/http(s?)/.test(e[1])?e[1]+"://"+e[2]:e[2],c=e[1],!aa.adapters[c].valid())throw"Invalid adapter";return{name:a,adapter:e[1]}}var f="idb"in aa.adapters&&"websql"in aa.adapters&&ca()&&localStorage["_pouch__websqldb_"+aa.prefix+a];if(b.adapter)d=b.adapter;else if("undefined"!=typeof b&&b.db)d="leveldb";else for(var g=0;g<aa.preferredAdapters.length;++g)if(d=aa.preferredAdapters[g],d in aa.adapters){if(f&&"idb"===d){console.log('PouchDB is downgrading "'+a+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}c=aa.adapters[d];var h=c&&"use_prefix"in c?c.use_prefix:!0;return{name:h?aa.prefix+a:a,adapter:d}},aa.adapter=function(a,b,c){b.valid()&&(aa.adapters[a]=b,c&&aa.preferredAdapters.push(a))},aa.plugin=function(a){return Object.keys(a).forEach(function(b){aa.prototype[b]=a[b]}),aa},aa.defaults=function(a){function b(c,d,e){return this instanceof b?(("function"==typeof d||"undefined"==typeof d)&&(e=d,d={}),c&&"object"==typeof c&&(d=c,c=void 0),d=Uc.extend({},a,d),void aa.call(this,c,d,e)):new b(c,d,e)}return Wc(b,aa),da(b),b.preferredAdapters=aa.preferredAdapters.slice(),Object.keys(aa).forEach(function(a){a in b||(b[a]=aa[a])}),b};var Nd=ja(),Od=function(){},Pd=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Qd="queryKey",Rd=/(?:^|&)([^&=]*)=?([^&]*)/g,Sd=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Td=function(a){return atob(a)},Ud=function(a){return btoa(a)},Vd=Vc.extend,Wd={ajax:na,parseUri:oa,uuid:J,Promise:fd,atob:Td,btoa:Ud,binaryStringToBlobOrBuffer:qa,clone:j,extend:Vd,createError:B},Xd=ad.collate,Yd=1,Zd="pouchdb",$d=5,_d=0;va.prototype.writeCheckpoint=function(a,b){var c=this;return this.updateTarget(a,b).then(function(){return c.updateSource(a,b)})},va.prototype.updateTarget=function(a,b){return ua(this.target,this.id,a,b,this.returnValue)},va.prototype.updateSource=function(a,b){var c=this;return this.readOnlySource?fd.resolve(!0):ua(this.src,this.id,a,b,this.returnValue)["catch"](function(a){if(za(a))return c.readOnlySource=!0,!0;throw a})};var ae={undefined:function(a,b){return 0===Xd(a.last_seq,b.last_seq)?b.last_seq:0},1:function(a,b){return wa(b,a).last_seq}};va.prototype.getCheckpoint=function(){var a=this;return a.target.get(a.id).then(function(b){return a.readOnlySource?fd.resolve(b.last_seq):a.src.get(a.id).then(function(a){if(b.version!==a.version)return _d;var c;return c=b.version?b.version.toString():"undefined",c in ae?ae[c](b,a):_d},function(c){if(404===c.status&&b.last_seq)return a.src.put({_id:a.id,last_seq:_d}).then(function(){return _d},function(c){return za(c)?(a.readOnlySource=!0,b.last_seq):_d});throw c})})["catch"](function(a){if(404!==a.status)throw a;return _d})};var be=0,ce=d.setImmediate||d.setTimeout,de=32768,ee=l(function(a,b){function c(){var d=h*f,e=d+f;if(h++,g>h)j(i,a,d,e),ce(c);else{j(i,a,d,e);var k=i.end(!0),l=Da(k);b(null,l),i.destroy()}}var d="string"==typeof a,e=d?a.length:a.byteLength,f=Math.min(de,e),g=Math.ceil(e/f),h=0,i=d?new dd:new dd.ArrayBuffer,j=d?Fa:Ea;c()});Wc(Ma,Yc.EventEmitter),Ma.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Ma.prototype.ready=function(a,b){function c(){e.cancel()}function d(){a.removeListener("destroyed",c),b.removeListener("destroyed",c)}var e=this;e._readyCalled||(e._readyCalled=!0,a.once("destroyed",c),b.once("destroyed",c),e.once("complete",d))};var fe={replicate:Oa,toPouch:Na},ge=fe.replicate;Wc(Qa,Yc.EventEmitter),Qa.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var he=25,ie=50,je={},ke=1800,le=$c("pouchdb:http");bb.valid=function(){return!0},cb.prototype.add=function(a){return this.promise=this.promise["catch"](function(){}).then(function(){return a()}),this.promise},cb.prototype.finish=function(){return this.promise};var me,ne=function(a,b){return b&&a.then(function(a){c.nextTick(function(){b(null,a)})},function(a){c.nextTick(function(){b(a)})}),a},oe=function(a){return Zc(function(b){var c=b.pop(),d=a.apply(this,b);return"function"==typeof c&&ne(d,c),d})},pe=function(a,b){return a.then(function(a){return b().then(function(){return a})},function(a){return b().then(function(){throw a})})},qe=function(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}},re=function(a){for(var b={},c=0,d=a.length;d>c;c++)b["$"+a[c]]=!0;var e=Object.keys(b),f=new Array(e.length);for(c=0,d=e.length;d>c;c++)f[c]=e[c].substring(1);return f},se={uniq:re,sequentialize:qe,fin:pe,callbackify:oe,promisedCallback:ne},te=ad.collate,ue=ad.toIndexableString,ve=ad.normalizeKey,we=ad.parseIndexableString;me="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var xe=se.callbackify,ye=se.sequentialize,ze=se.uniq,Ae=se.fin,Be=se.promisedCallback,Ce={},De=new cb,Ee=50,Fe={_sum:function(a,b){return qb(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];b+=e*e}return b}return{sum:qb(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}},Ge=xe(function(){var a=this;return"http"===a.type()?Ib(a):"function"==typeof a._viewCleanup?yb(a):Jb(a)}),He=function(a,b,c){"function"==typeof b&&(c=b,b={}),b=b?tb(b):{},"function"==typeof a&&(a={map:a});var d=this,e=fd.resolve().then(function(){return Kb(d,a,b)});return Be(e,c),e};Wc(Lb,Error),Wc(Mb,Error),Wc(Nb,Error);var Ie={query:He,viewCleanup:Ge},Je=5,Ke="document-store",Le="by-sequence",Me="attach-store",Ne="attach-seq-store",Oe="meta-store",Pe="local-store",Qe="detect-blob-support",Re={running:!1,queue:[]};Wc(uc,Yc.EventEmitter),uc.prototype.addListener=function(a,b,c,d){function e(){function a(){h=!1}if(g._listeners[b]){if(h)return void(h="waiting");h=!0;var i=f(d,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);c.changes(i).on("change",function(a){a.seq>d.since&&!d.cancelled&&(d.since=a.seq,d.onChange(a))}).on("complete",function(){"waiting"===h&&setTimeout(function(){e()},0),h=!1}).on("error",a)}}if(!this._listeners[b]){var g=this,h=!1;this._listeners[b]=e,this.on(a,e)}},uc.prototype.removeListener=function(a,b){b in this._listeners&&Yc.EventEmitter.prototype.removeListener.call(this,a,this._listeners[b])},uc.prototype.notifyLocalWindows=function(a){ba()?chrome.storage.local.set({dbName:a}):ca()&&(localStorage[a]="a"===localStorage[a]?"b":"a")},uc.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)};var Se,Te={};vc.valid=function(){var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!a&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},vc.Changes=new uc;var Ue=7,Ve=Dc("document-store"),We=Dc("by-sequence"),Xe=Dc("attach-store"),Ye=Dc("local-store"),Ze=Dc("metadata-store"),$e=Dc("attach-seq-store"),_e={},af=1,bf="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+We+" (seq, deleted)",cf="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+We+" (doc_id, rev)",df="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Ve+" (winningseq)",ef="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+$e+" (seq)",ff="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+$e+" (digest, seq)",gf=We+".seq = "+Ve+".winningseq",hf=We+".seq AS seq, "+We+".deleted AS deleted, "+We+".json AS data, "+We+".rev AS rev, "+Ve+".json AS metadata";Tc.valid=Qc,Tc.Changes=new uc;var jf={idb:vc,websql:Tc};aa.ajax=na,aa.utils=Wd,aa.Errors=Fd,aa.replicate=fe.replicate,aa.sync=Pa,aa.version="5.2.1",aa.adapter("http",bb),aa.adapter("https",bb),aa.plugin(Ie),Object.keys(jf).forEach(function(a){aa.adapter(a,jf[a],!0)}),b.exports=aa}).call(this,a(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});