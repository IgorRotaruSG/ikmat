function getHaccpItemCall(a,b){if(0==b.rows.length)Page.redirect("haccp.html");else{var c=!1;0!=b.rows.item(0).response&&(c=$.parseJSON(b.rows.item(0).response));var d,e=$.parseJSON(b.rows.item(0).form),f="";for(var g in e)if(e.hasOwnProperty(g)){if(d=!1,"answer"==g)continue;"possibility"==g&&(e[g].label=b.rows.item(0).content),void 0!=c[g]&&(d=c[g]),f+=Form.radioListHACCP(g,e[g].label,e[g].answers,d)}c?(console.log(c),$(".haccp_color_table").find("tr").eq(3-parseInt(c.possibility)).find("td").eq(parseInt(c.consequence)+1).html('<i class="fa fa-check"></i>')):f+=Form.submitHACCP(),$("#haccp_item_data").html(f),$("#"+$.mobile.activePage.attr("id")).trigger("create")}}function getHaccpItem(a){query='select * from haccp_items where "id" = "'+get.id+'"',a.executeSql('select * from haccp_items where "id" = "'+get.id+'"',[],getHaccpItemCall,db.dbErrorHandle)}function haccp_itemInit(){if(User.isLogged()){$("#haccp_item_data").off("submit").on("submit",function(b){b.preventDefault();var c=$(this);$(this).find("input").each(function(){void 0==dd[$(this).attr("name")]&&(dd[$(this).attr("name")]=-1),$(this).is(":checked")&&(dd[$(this).attr("name")]=$(this).val())});var d=!0;for(i in dd)dd.hasOwnProperty(i)&&(a[i]==-1?(d=!1,c.find('input[name="'+i+'"]').first().parent().parent().find("p").remove(),c.find('input[name="'+i+'"]').first().parent().parent().append($('<p style="color:red;">This is required</p>'))):c.find('input[name="'+i+'"]').first().parent().parent().find("p").remove());if(d){dd.subcategory=get.id;var e={client:User.client,token:User.lastToken,haccp_category:get.catId,response:JSON.stringify(dd)};Page.apiCall("haccp",e,"get","haccpComplete")}return!1}),get=Page.get();var a=db.getDbInstance();a.transaction(getHaccpItem,db.dbErrorHandle)}else Page.redirect("login.html")}function haccpComplete(a){var b="UPDATE haccp_items SET response = '"+JSON.stringify(dd)+"' WHERE id = '"+get.id+"'";db.clean(),db.execute(b),a.success&&a.haccp_response&&a.haccp_response.deviation&&a.haccp_response.task_id?Page.redirect("haccp_deviation.html?id="+a.haccp_response.task_id):Page.redirect("haccp_cat.html?catId="+get.catId)}var get,dd={};