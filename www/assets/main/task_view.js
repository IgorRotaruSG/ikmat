function getTask(){db.getDBInstance("tasks").get(get.id,getTaskCall)}function getTaskCall(a,b){if(a)alert("Task not found!"),Page.redirect("tasks.html");else if(""==b.taskData||null==b.taskData||0==b.taskData.length)if(isOffline())alert($.t("error.task_not_fetched")),Page.redirect("tasks.html");else{var c={client:User.client,token:User.lastToken,task_id:get.id};Page.apiCall("getTask",c,"get","taskInfo")}else{completedDate="",""!=b.completeDate&&null!=b.completeDate&&(completedDate=$.parseJSON(b.completeDate)),taskData="",""!=b.taskData&&null!=b.taskData&&(taskData=$.parseJSON(b.taskData));var c={tasks:{taskName:b.title,completedBy:b.completedBy,completeDate:completedDate,taskData:taskData}};showTaskInfo(c)}}function task_viewInit(){User.isLogged()?(get=Page.get(),getTask()):Page.redirect("login.html")}function taskInfo(a){a.success&&(void 0!=a.tasks&&void 0!=a.tasks.taskData&&(q='UPDATE tasks SET "taskData" = \''+JSON.stringify(a.tasks.taskData)+'\' WHERE "id" = "'+a.tasks.id+'"',db.clean(),db.execute(q)),showTaskInfo(a))}function showTaskInfo(a){console.log("----------------------------------------------------"),console.log(a);var b="";if(a.success&&a.form_list_question){b+='<form id="task_form_submit">',b+="<legend>"+a.form_list_question.label+"</legend>",b+=Form.inputHidden("type",a.form_list_question.type),b+=Form.inputHidden("question_id",a.form_list_question.id),b+=Form.inputHidden("module",a.form_list_question.module),b+=Form.inputHidden("task_id",get.id);var c=a[a.form_list_question.type];for(var d in c)if(c.hasOwnProperty(d)&&(inp=c[d],void 0!=inp.input))switch(inp.input.type){case"text":b+=Form.inputText(d,inp.label,inp.input.placeholder,inp.validation,inp.name,inp.value);break;case"multiple_text":b+="form12"==d||"form13"==d||"form14"==d||"form15"==d||"form16"==d?Form.multipleInputTextFridge(j,inp.label,inp.input.placeholder,inp.validation,inp.input.fields):Form.multipleInputText(j,inp.label,inp.input.placeholder,inp.validation);break;case"textarea":b+=Form.textarea(d,inp.label,inp.input.placeholder,inp.validation);break;case"select":b+=Form.selectBox(d,inp.label,inp.input.data,inp.input.placeholder,inp.validation);break;case"checkbox_list":b+=Form.checkboxList(d,inp.label,inp.input.value,inp.answers,inp.name);break;case"multiple_text_color":b+=Form.multipleTextColor(d,inp.label,inp.answers);break;case"radio_list":b+="form7"==d||"form9"==d||"form8"==d||"form11"==d?Form.radioList(d,inp.label,inp.input.value,inp.answers,inp.name,!0):Form.radioList(d,inp.label,inp.input.value,inp.answers,inp.name);break;case"date":b+="form7"==d||"form9"==d||"form8"==d||"form11"==d?Form.inputDate(d,inp.label,inp.input.placeholder,!0):Form.inputDate(d,inp.label,inp.input.placeholder);break;case"custom":b+=Form.customStep10(d,inp.label,inp.measurement_question_id,inp.frequency,inp.haccp);break;case"text_clicker":b+=Form.clickIncrement(d,inp.label,inp.input.data,inp.validation);break;case"slider":b+=Form.slider(d,inp.label,inp.unit,inp.interval.min,inp.interval.max,0)}b+=Form.submitButton(),b+="</form>",$("#task_info").html(b),$("#"+$.mobile.activePage.attr("id")).trigger("create"),$("#task_form_submit").submit(function(a){a.preventDefault();var b=Form.getValues($(this)),c={client:User.client,token:User.lastToken,results:JSON.stringify(b)};return console.log(c),Page.apiCall("formDeviationStart",c,"get","saveFormFridgeDone"),!1})}}function saveFridge(){var a=Form.getValues($("#form_fridge")),b={client:User.client,token:User.lastToken,results:JSON.stringify(a)};console.log(b),Page.apiCall("formDeviationStart",b,"get","saveFormFridgeDone")}function saveFormFridgeDone(a){console.log("aici am facut save"),console.log(a),void 0!=a.form_deviation&&void 0!=a.form_deviation.last_task_inserted&&a.form_deviation.deviation?Page.redirect("haccp_deviation.html?id="+a.form_deviation.last_task_inserted):Page.redirect("tasks.html")}function saveFormFood(){var a=Form.getValues($("#form_food")),b={client:User.client,token:User.lastToken,results:JSON.stringify(a)};console.log(b),Page.apiCall("formDeviationStart",b,"get","saveFormFoodDone")}function saveFormFoodDone(a){Page.redirect("tasks.html")}function markTaskAsComplete(){var a={};$(".sendThis").each(function(){"checkbox"==$(this).attr("type")?$(this).is(":checked")?a[$(this).attr("name")]="true":a[$(this).attr("name")]="false":a[$(this).attr("name")]=$(this).val()});var b={client:User.client,token:User.lastToken,task_id:get.id,data:JSON.stringify(a)};Page.apiCall("setTaskComplete",b,"get","setTaskComplete"),uploadPicture()}function setTaskComplete(a){if(console.log("asdasdadsa:"),console.log(a),void 0!=a.response&&void 0!=a.response.response&&(alert(a.response.response),Page.redirect("tasks.html")),1==a.success&&(void 0!=a.response.Success&&1==a.response.Success&&Page.redirect("tasks.html"),void 0!=a.response.form_deviation)){var b='<input type="hidden" name="is_deviation" value="1" class="sendThis">';for(i in a.response.form_deviation){console.log(a.response.form_deviation[i]),b+="action_needed"==i?'<li style="display:none;" id="li_action_needed">':"<li>",b+='<fieldset data-role="controlgroup">',"checkbox"!=a.response.form_deviation[i].input.type&&(b+='<label for="inp_'+i+'">'+a.response.form_deviation[i].label+"</label>");var c,d,e;switch(-1!==a.response.form_deviation[i].input.type.indexOf("/")?(e=!0,c=a.response.form_deviation[i].input.type.split("/"),d=c[0]):(e=!1,d=a.response.form_deviation[i].input.type),d){case"textarea":b+='<textarea name="'+i+'" class="sendThis" placeholder="'+a.response.form_deviation[i].input.placeholder+'" id="inp_'+i+'"></textarea>';break;case"text":if(e)switch(c[1]){case"deg":b+='<div class="input-group"><input type="text" class="form-control sendThis" name="'+i+'" placeholder="'+a.response.form_deviation[i].input.placeholder+'"><span class="input-group-addon">&deg;C</span></div>'}else b+='<input type="text" name="'+i+'" class="sendThis" placeholder="'+a.response.form_deviation[i].input.placeholder+'" id="inp_'+i+'" />';break;case"date":b+='<input type="date" name="'+i+'" class="sendThis" placeholder="'+a.response.form_deviation[i].input.placeholder+'" />';break;case"select":b+='<select class="form-control sendThis" name="'+i+'">';for(j in a.response.form_deviation[i].data)if(a.response.form_deviation[i].data.hasOwnProperty(j)){for(var f in a.response.form_deviation[i].data[j])break;b+='<option value="'+f+'">'+a.response.form_deviation[i].data[j][f]+"</option>"}b+="</select>";break;case"checkbox":b+="now_or_further"==i?'<input type="checkbox" id="inp_'+i+'" name="'+i+"\" class=\"sendThis\" onclick=\"if($(this).is(':checked')){$('#li_action_needed').show();}else{$('#li_action_needed').hide();}$('#task_view').find('#task_info').listview('refresh');\" />":'<input type="checkbox" id="inp_'+i+'" name="'+i+'" class="sendThis"/>',b+='<label for="inp_'+i+'">'+a.response.form_deviation[i].label+"</label>";break;case"file":b+='<div data-role="controlgroup">',b+='<a href="#" onclick="takePicture();" data-role="button" data-theme="a">'+$.t("pictures.take")+"</a>",b+='<a href="#" onclick="selectPicture();" data-role="button" data-theme="a">'+$.t("pictures.select")+"</a>",b+="</div>";break;case"signature":b+='<div id="signature-holder">',b+='<div id="signature" data-role="none"></div>',b+="</div>",b+='<span id="signature-status-message">Sign in landscape mode for better accuracy</span>',b+='<button id="signature-reset" data-theme="a">Reset Signature</button>'}b+="</fieldset>",b+="</li>"}$("#task_view").find("#task_info").html(""),$(b).appendTo("#task_info").trigger("create"),$("#task_view").find("#task_info").listview("refresh")}}function takePicture(){navigator.camera.getPicture(function(a){$("#camera_image").css({visibility:"visible",display:"block"}).attr("src",a)},function(a){console.log("Error getting picture: "+a)},{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI})}function selectPicture(){navigator.camera.getPicture(function(a){"content://com.android"==a.substring(0,21)&&(photo_split=a.split("%3A"),a="content://media/external/images/media/"+photo_split[1]),$("#camera_image").css({visibility:"visible",display:"block"}).attr("src",a)},function(a){console.log("Error getting picture: "+a)},{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY})}function uploadPicture(){var a=$("#camera_image"),b=a.attr("src");if(b&&(a.css({visibility:"hidden",display:"none"}).attr("src",""),server=Page.settings.apiDomain+Page.settings.apiUploadPath,console.log(server),server)){var c=new FileUploadOptions;c.fileKey="file",c.fileName=b.substr(b.lastIndexOf("/")+1),c.mimeType="image/jpeg",c.chunkedMode=!1;var d={};d.task_id=get.id,d.client=User.client,d.token=User.lastToken,c.params=d;var e=new FileTransfer;e.upload(b,server,function(a){console.log("Upload successful: "+a.bytesSent+" bytes uploaded.")},function(a){console.log("Upload failed: Code = "+a.code)},c)}}var get,$sigdiv;