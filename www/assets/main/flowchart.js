function getFlowchartCall(a,b){if(isOffline())$("#alertPopup .alert-text").html($.t("error.no_internet_for_sync")),$("#alertPopup").on("popupafterclose",function(){$("#alertPopup").unbind("popupafterclose"),window.location.href="index.html"}),$("#alertPopup").popup("open",{positionTo:"window"}),$("#no_results_flowchart").text($.t("forms.no_forms_connection")),$(".overflow-wrapper").addClass("overflow-wrapper-hide");else{var c={client:User.client,token:User.lastToken};Page.apiCall("flowchart",c,"get","showFlowchart")}mySwiper.reInit(),mySwiper.resizeFix()}function getFlowcharts(a){a.executeSql('SELECT * FROM "flowchart"',[],getFlowchartCall)}function flowchartInit(){if(User.isLogged()){executeSyncQuery();var a=db.getDbInstance();a.transaction(getFlowcharts,db.dbErrorHandle),mySwiper=new Swiper(".swiper-container-flowchart",{calculateHeight:!0,releaseFormElements:!0,preventLinks:!0,simulateTouch:!0,keyboardControl:!1,noSwiping:!0,noSwipingClass:"ui-slider",onInit:function(){setSwiperMinHeight()},onSlideNext:function(a){},onSlidePrev:function(a){},onSlideChangeEnd:function(a){}})}else Page.redirect("login.html")}function showFlowchart(a){if(a.success){var b="";if(a.flowcharts.length>0){for(var c in a.flowcharts)if(a.flowcharts.hasOwnProperty(c)){var d=settings.apiPath+a.flowcharts[c].path+"originals/"+a.flowcharts[c].name,e=settings.apiPath+a.flowcharts[c].path+"originals/"+a.flowcharts[c].name;b+='<div class="image_element"><a href="'+e+'" class="swipebox" title="'+a.flowcharts[c].description+'" data-id="'+a.flowcharts[c].id+'" ><img src="'+d+'" alt="image" /></a></div>'}b+='<div class="clearfix"></div>',$("#no_results_flowchart").hide(),$(".overflow-wrapper").addClass("overflow-wrapper-hide"),$("#flowchart_list").html(b),$(".swipebox").swipebox({useCSS:!0,useSVG:!0,initialIndexOnArray:0,hideCloseButtonOnMobile:!0,hideBarsDelay:17e3,videoMaxWidth:1140,beforeOpen:function(){},afterOpen:function(){},afterClose:function(){},loopAtEnd:!0}),$('a[data-id="'+a.flowcharts[0].id+'"]').trigger("click")}else $("#no_results_flowchart").text($.t("error.no_data")),$("#no_results_flowchart").show(),$(".overflow-wrapper").addClass("overflow-wrapper-hide");$("#"+$.mobile.activePage.attr("id")).trigger("create"),$("#reset-flowchart").off("click").on("click",function(){var a={client:User.client,token:User.lastToken};Page.apiCall("resetFlowchart",a,"get","resetFlowchart")})}}function deleteFlowchart(a){confirm_action=!1,$("#confirmPopup .alert-text").html($.t("general.flowchart_delete")),$("#confirmPopup").off("popupafteropen").on("popupafteropen",function(a,b){$("#confirmButton").off("click").on("click",function(){confirm_action=!0,$("#confirmPopup").popup("close")})}),$("#confirmPopup").off("popupafterclose").on("popupafterclose",function(b,c){if($("#confirmButton").unbind("click"),confirm_action){if(!isOffline()){var d={client:User.client,token:User.lastToken,flowchart_id:a};Page.apiCall("removeFlowchart",d,"get","removeFlowchart")}}else console.log("du nathing")}),$("#confirmPopup").popup("open",{positionTo:"window"})}function printFlowchart(a,b){if(isNative()&&cordova.plugins&&cordova.plugins.email)cordova.plugins.printer.print(encodeURIComponent(a),{name:"Document.html",landscape:!0},function(){});else{w=window.open();var c='<style>.image_element {width: 96%;height: 96%;text-align: left;line-height: normal;display: block;margin: 0 1px 1px 0;float: left;}.image_element a {display: block;height: 100%;width: 100%;padding-left: 20px}.image_element a img {max-width:100% !important;max-height:100%!important;display:block;}</style><div class="image_element"><strong>'+b+'</trong><br><a class="ui-link"><img src="'+a+'" /></a></div>';w.document.write(c),w.print(),w.close()}}function emailFlowchart(a){console.log("flowchartId",$("#flowchart_list").find("a[data-id="+a+"]"));var b=$("#flowchart_list").find("a[data-id="+a+"]"),c={image:$(b).attr("href"),title:$(b).attr("title")};openNativeEmail(c)}function openNativeEmail(a){var b=(a.title+" Flytskjema").toUpperCase(),c={subject:b,cc:localStorage.getItem("user_email")?localStorage.getItem("user_email"):""};if(a.image.length>0&&(isNative()?(c.isHtml=!0,c.body='<div>Trykk p책 lenken nedenfor for 책 se flytskjema: </div><div><a href="'+encodeURI(a.image)+'"><img width="100%" alt="'+encodeURI(a.image)+'" src="'+encodeURI(a.image)+'" ></a></div>'):c.body="Trykk p책 lenken nedenfor for 책 se flytskjema: \n"+encodeURI(a.image)),isNative()&&cordova.plugins&&cordova.plugins.email)cordova.plugins.email.isAvailable(function(a){cordova.plugins.email.open(c)});else{var d="mailto:?subject="+c.subject;c.cc&&(d+="&cc="+c.cc),c.body&&(d+="&body="+c.body),location.href=d}}function removeFlowchart(a){a.success&&"true"==a.success&&a.flowchart_id&&($("#swipebox-close").trigger("click"),$('a[data-id="'+a.flowchart_id+'"]').parent().remove(),0==$("#flowchart_list .image_element").length&&($("#no_results_flowchart").text($.t("error.no_data")),$("#no_results_flowchart").show(),$(".overflow-wrapper").addClass("overflow-wrapper-hide")))}function resetFlowchart(a){if(a.success&&1==a.success){var b=db.getDbInstance();b.transaction(getFlowcharts,db.dbErrorHandle)}}function sendEmailFlowchart(a){$("#confirm-send").removeAttr("disabled"),$("#confirm-send").parent().find(".ui-btn-text").html($.t("general.send")),$("#popup-send-email-flowchart").popup("close"),$(".swiper-slide-active").scrollTop(0)}var mySwiper,_h_content=0,_t;$(window).on("orientationchange",function(a){$(".ui-popup-container").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px",overflow:"hidden",position:"fixed"}),setTimeout(function(){$("#signature_pop-popup").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px"})},500)});