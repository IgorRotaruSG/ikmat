function getFlowchartCall(a,b){if(isOffline())$("#alertPopup .alert-text").html($.t("error.no_internet_for_sync")),$("#alertPopup").on("popupafterclose",function(){$("#alertPopup").unbind("popupafterclose"),window.location.href="index.html"}),$("#alertPopup").popup("open",{positionTo:"window"}),$("#no_results_flowchart").text($.t("forms.no_forms_connection")),$(".overflow-wrapper").addClass("overflow-wrapper-hide");else{var c={client:User.client,token:User.lastToken};Page.apiCall("flowchart",c,"get","showFlowchart")}mySwiper.reInit(),mySwiper.resizeFix()}function getFlowcharts(a){a.executeSql('SELECT * FROM "flowchart"',[],getFlowchartCall)}function flowchartInit(){if(User.isLogged()){executeSyncQuery();var a=db.getDbInstance();a.transaction(getFlowcharts,db.dbErrorHandle),mySwiper=new Swiper(".swiper-container-flowchart",{calculateHeight:!0,releaseFormElements:!0,preventLinks:!0,simulateTouch:!0,keyboardControl:!1,noSwiping:!0,noSwipingClass:"ui-slider",onInit:function(){setSwiperMinHeight()},onSlideNext:function(a){},onSlidePrev:function(a){},onSlideChangeEnd:function(a){}})}else Page.redirect("login.html")}function showFlowchart(a){if(a.success){var b="";if(a.flowcharts.length>0){for(var c in a.flowcharts)if(a.flowcharts.hasOwnProperty(c)){var d=settings.apiPath+a.flowcharts[c].path+"originals/"+a.flowcharts[c].name,e=settings.apiPath+a.flowcharts[c].path+"originals/"+a.flowcharts[c].name;b+='<div class="image_element"><a href="'+e+'" class="swipebox" title="'+a.flowcharts[c].description+'" data-id="'+a.flowcharts[c].id+'" ><img src="'+d+'" alt="image" /></a></div>'}b+='<div class="clearfix"></div>',$("#no_results_flowchart").hide(),$(".overflow-wrapper").addClass("overflow-wrapper-hide"),$("#flowchart_list").html(b),$(".swipebox").swipebox({useCSS:!0,useSVG:!0,initialIndexOnArray:0,hideCloseButtonOnMobile:!0,hideBarsDelay:17e3,videoMaxWidth:1140,beforeOpen:function(){},afterOpen:function(){},afterClose:function(){},loopAtEnd:!0}),$('a[data-id="'+a.flowcharts[0].id+'"]').trigger("click")}else $("#no_results_flowchart").text($.t("error.no_data")),$("#no_results_flowchart").show(),$(".overflow-wrapper").addClass("overflow-wrapper-hide");var f='<div class="row text-center" style="margin-top:20px;"><button title="Load more" id="reset-flowchart">Reset <i class="fa fa-undo"></i></button></div>';$("#flowchart_list").append(f),$("#"+$.mobile.activePage.attr("id")).trigger("create"),$("#reset-flowchart").off("click").on("click",function(){var a={client:User.client,token:User.lastToken};Page.apiCall("resetFlowchart",a,"get","resetFlowchart")})}}function deleteFlowchart(a){confirm_action=!1,$("#confirmPopup .alert-text").html($.t("general.flowchart_delete")),$("#confirmPopup").off("popupafteropen").on("popupafteropen",function(a,b){$("#confirmButton").off("click").on("click",function(){confirm_action=!0,$("#confirmPopup").popup("close")})}),$("#confirmPopup").off("popupafterclose").on("popupafterclose",function(b,c){if($("#confirmButton").unbind("click"),confirm_action){if(!isOffline()){var d={client:User.client,token:User.lastToken,flowchart_id:a};Page.apiCall("removeFlowchart",d,"get","removeFlowchart")}}else console.log("du nathing")}),$("#confirmPopup").popup("open",{positionTo:"window"})}function printFlowchart(a){cordova.plugins.printer.print(encodeURIComponent(a),{name:"Document.html",landscape:!0},function(){})}function emailFlowchart(a){$("#popup-send-email-flowchart").unbind("popupafterclose"),$("#popup-send-email-flowchart").popup("open"),$("#popup-send-email-flowchart").parent().css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px",overflow:"hidden",position:"fixed"}),$("#popup-send-email-flowchart").css("height","100%"),$("#confirm-send").off("click").on("click",function(b,c){var d=HTML.validate($("#popup-send-email-flowchart"));if(d){$("#confirm-send").attr("disabled",!0),$("#confirm-send").parent().find(".ui-btn-text").html($.t("general.loading")),$(".overflow-wrapper").addClass("overflow-wrapper-hide");var e={client:User.client,token:User.lastToken,report_id:15,flowchart_id:a,email:$("#email").val()};Page.apiCall("send-report-by-email",e,"get","sendEmailFlowchart")}})}function removeFlowchart(a){a.success&&"true"==a.success&&a.flowchart_id&&($("#swipebox-close").trigger("click"),$('a[data-id="'+a.flowchart_id+'"]').parent().remove(),0==$("#flowchart_list .image_element").length&&($("#no_results_flowchart").text($.t("error.no_data")),$("#no_results_flowchart").show(),$(".overflow-wrapper").addClass("overflow-wrapper-hide")))}function resetFlowchart(a){if(a.success&&1==a.success){var b=db.getDbInstance();b.transaction(getFlowcharts,db.dbErrorHandle)}}function sendEmailFlowchart(a){$("#confirm-send").removeAttr("disabled"),$("#confirm-send").parent().find(".ui-btn-text").html($.t("general.send")),$("#popup-send-email-flowchart").popup("close"),$(".swiper-slide-active").scrollTop(0)}var mySwiper,_h_content=0,_t;$(window).on("orientationchange",function(a){$(".ui-popup-container").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px",overflow:"hidden",position:"fixed"}),setTimeout(function(){$("#signature_pop-popup").css({top:0,left:0,"max-width":"100%",width:"100%",height:parseInt($("body").height())+"px"})},500)});